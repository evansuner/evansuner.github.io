<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>03 Django高级 | Evan&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="choice参数(数据库字段设计常见)12345678910111213141516171819202122232425262728用户表	性别    学历    工作经验    是否结婚    客户来源    ...class User(models.Model):    username &#x3D; models.CharField(max_length&#x3D;32)    age &#x3D; models.Int">
<meta property="og:type" content="article">
<meta property="og:title" content="03 Django高级">
<meta property="og:url" content="http://example.com/2021/03/10/03%20Django%E9%AB%98%E7%BA%A7-03django%E9%AB%98%E7%BA%A7/index.html">
<meta property="og:site_name" content="Evan&#39;s Blog">
<meta property="og:description" content="choice参数(数据库字段设计常见)12345678910111213141516171819202122232425262728用户表	性别    学历    工作经验    是否结婚    客户来源    ...class User(models.Model):    username &#x3D; models.CharField(max_length&#x3D;32)    age &#x3D; models.Int">
<meta property="og:locale">
<meta property="article:published_time" content="2021-03-09T19:17:11.000Z">
<meta property="article:modified_time" content="2021-11-08T19:55:26.478Z">
<meta property="article:author" content="Evan">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="django">
<meta name="twitter:card" content="summary">
  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
    });
  </script>
  
<link rel="stylesheet" href="/css/index.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Evan&#39;s Blog</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://github.com/evansuner" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">03 Django高级</h2>
  <p class="sub">Mar 10, 2021</p>
  <article class="content">
    <h2 id="choice参数-数据库字段设计常见"><a href="#choice参数-数据库字段设计常见" class="headerlink" title="choice参数(数据库字段设计常见)"></a>choice参数(数据库字段设计常见)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">用户表</span><br><span class="line">	性别</span><br><span class="line">    学历</span><br><span class="line">    工作经验</span><br><span class="line">    是否结婚</span><br><span class="line">    客户来源</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    gender_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;男&#x27;</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">&#x27;女&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 字段类型的选择取决于上面定义对应关系时的第一个变量</span></span><br><span class="line">    gender = models.IntegerField(choices=gender_choices)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    gender字段存储的还是数字 但是如果存储的狮子在上面元组的列举范围之内</span></span><br><span class="line"><span class="string">    那么可以非常轻松的或得到数字对应的真正内容</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    1. 如果gender字段存的狮子不在上述元组列表的范围时</span></span><br><span class="line"><span class="string">        存的时候 没有列举出来的数字还是根据存储的字段类型决定,依旧会存储在内</span></span><br><span class="line"><span class="string">    2. 如果在 如何获取到对应的中文信息</span></span><br><span class="line"><span class="string">        只要是choices参数的字段 如果你想要获取对应的信息 固定写法 get_字段名_display()</span></span><br><span class="line"><span class="string">        如果没有对应关系,那么存储的字段内容是什么就返回什么</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MTV与MVC模型-了解"><a href="#MTV与MVC模型-了解" class="headerlink" title="MTV与MVC模型(了解)"></a>MTV与MVC模型(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MTV: django号称是mtv模型</span></span><br><span class="line">M: models</span><br><span class="line">T: templates</span><br><span class="line">V: views</span><br><span class="line"><span class="comment"># MVC: 其实django本质上还是mvc</span></span><br><span class="line">M: models</span><br><span class="line">V: views</span><br><span class="line">C: controller</span><br><span class="line">    </span><br><span class="line"><span class="comment"># vue框架: MVVM模型</span></span><br></pre></td></tr></table></figure>

<h2 id="多对多三种创建方式"><a href="#多对多三种创建方式" class="headerlink" title="多对多三种创建方式"></a>多对多三种创建方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全自动:	利用orm自动帮助我们创建第三张关系表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">有点: 代码不需要自己写 非常的方便 还支持orm提供操作第三张表的方法</span></span><br><span class="line"><span class="string">缺点: 第三张表的扩展性比较差(没有办法额外添加字段)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 全手动(不建议)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book2Author</span>(models.Model):</span><br><span class="line">    book_id = models.ForeignKey(to=<span class="string">&#x27;Book&#x27;</span>)</span><br><span class="line">    author_id = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">优点: 第三张表完全取决于你自己进行额外的扩展</span></span><br><span class="line"><span class="string">不足: 需要写的代码比较多 不能使用orm提供的简单的方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 半自动</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>,</span><br><span class="line">                                     through=<span class="string">&#x27;Book2Author&#x27;</span>,</span><br><span class="line">                                     through_fields=(<span class="string">&#x27;book&#x27;</span>, <span class="string">&#x27;author&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    <span class="comment"># name = models.CharField(max_length=32)</span></span><br><span class="line">    <span class="comment"># book = models.ManyToManyField(to=&#x27;Author&#x27;,</span></span><br><span class="line">    <span class="comment">#                                  through=&#x27;Book2Author&#x27;,</span></span><br><span class="line">    <span class="comment">#                                  through_fields=(&#x27;author&#x27;, &#x27;book&#x27;))</span></span><br><span class="line"><span class="comment"># through_fields的顺序当前表是谁 就把对应的字段放在前面</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book2Author</span>(models.Model):</span><br><span class="line">    book_id = models.ForeignKey(to=<span class="string">&#x27;Book&#x27;</span>)</span><br><span class="line">    author_id = models.ForeignKey(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">可以使用orm的正反向查询,但是没法使用add,set,remove,clear这四个方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>为了拓展性更高, 我们一般都会使用半自动</p>
</blockquote>
<h2 id="Ajax-Asynchronous-JavaScript-And-XML"><a href="#Ajax-Asynchronous-JavaScript-And-XML" class="headerlink" title="Ajax(Asynchronous JavaScript And XML)"></a>Ajax(Asynchronous JavaScript And XML)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">异步提交</span></span><br><span class="line"><span class="string">局部刷新</span></span><br><span class="line"><span class="string">例子: GitHub注册</span></span><br><span class="line"><span class="string">	动态获取用户名实时的跟后端确认并实时的展示到前端</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">朝后端发送请求的方式:</span></span><br><span class="line"><span class="string">	1. 浏览器地址栏直接输入url回车	GET请求</span></span><br><span class="line"><span class="string">	2. a标签href属性	GET请求</span></span><br><span class="line"><span class="string">	3. form表单     	GET请求/POST请求</span></span><br><span class="line"><span class="string">	4. ajax			 GET请求/POST请求</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">Ajax不是新的编程语言, 而是一种使用现有标准的方法(相当于装饰器)</span></span><br><span class="line"><span class="string">Ajax最大的优点是在不加在整个页面的情况下, 可以与服务器交换数据并更新不跟网页内容</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Ajax我们只学习jQuery封装之后的版本(不学原生的 原生的复杂并且在实际项目中一般不使用)</span></span><br><span class="line"><span class="string">所以我们在前端页面使用ajax的时候要确保导入了jQuery</span></span><br><span class="line"><span class="string">ps: 并不是只有jQuery能够实现ajax, 其他框架也可以 但是换汤不换药 原理都是一样的</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="小案例"><a href="#小案例" class="headerlink" title="小案例"></a>小案例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">页面上有三个input框</span></span><br><span class="line"><span class="string">	在前两个框中输入数字 点击按钮 朝后端发送ajax请求</span></span><br><span class="line"><span class="string">	后端计算出结构 再返回给前端动态展示的第三个input框中</span></span><br><span class="line"><span class="string">	(整个过程不允许刷新,也不能在前端计算)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 前端</span></span><br><span class="line">// 先给按钮绑定一个点击事件</span><br><span class="line">    $(<span class="string">&#x27;#btn&#x27;</span>).click(function()&#123;</span><br><span class="line">        // 朝后端发送ajax请求</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            // <span class="number">1.</span> 指定朝那个后端发送ajax请求</span><br><span class="line">            url:<span class="string">&#x27;&#x27;</span>, // 不写就是朝当前地址提交</span><br><span class="line">            // <span class="number">2.</span> 请求方式</span><br><span class="line">            <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>, // 不指定默认为get 都是小写</span><br><span class="line">            // <span class="number">3.</span> 数据</span><br><span class="line">            data:&#123;<span class="string">&#x27;digit1&#x27;</span>:$(<span class="string">&#x27;#d1&#x27;</span>).val(),<span class="string">&#x27;digit2&#x27;</span>:$(<span class="string">&#x27;#d2&#x27;</span>).val()&#125;,</span><br><span class="line">            // <span class="number">4.</span> 回调函数(异步回调机制) 当后端给你返回结果的时候会自动触发 args接受后端的返回结果</span><br><span class="line">            &#123;<span class="comment">#dateType:true, //会自动将后端返回的字符串序列化#&#125;</span></span><br><span class="line">            success:function(args)&#123;</span><br><span class="line">                &#123;<span class="comment">#$(&#x27;#d3&#x27;).val(args);#&#125;</span></span><br><span class="line">                console.log(typeof args);</span><br><span class="line">                console.log(args.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># 后端</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ab_ajax</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        first_digit = <span class="built_in">int</span>(request.POST.get(<span class="string">&#x27;digit1&#x27;</span>))</span><br><span class="line">        second_digit = <span class="built_in">int</span>(request.POST.get(<span class="string">&#x27;digit2&#x27;</span>))</span><br><span class="line">        result = first_digit + second_digit</span><br><span class="line">        d = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;msg&#x27;</span>: result&#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(d)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>针对后端如果是用HttpResponse返回的数据 回调函数不会自动反序列化</p>
<p>如果后端直接使用JsonResponse返回的数据 会叫函数不会自动反序列化</p>
<p>HTTPResponse解决方式</p>
<pre><code>1. 自己在前端利用JSON.parse()
2. 在ajax里面配置一个参数
</code></pre>
</blockquote>
<h2 id="前后端传输数据的编码格式-contentType"><a href="#前后端传输数据的编码格式-contentType" class="headerlink" title="前后端传输数据的编码格式(contentType)"></a>前后端传输数据的编码格式(contentType)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们主要研究post请求数据的编码格式</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">get请求数据及时直接放在url后面</span></span><br><span class="line"><span class="string">url?username=张三&amp;password=123</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 可以向后端发送post请求的方法:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. form表单</span></span><br><span class="line"><span class="string">2. ajax请求</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">前后端传输数据的编码格式</span><br><span class="line">urlencoded</span><br><span class="line">formdata</span><br><span class="line">json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 研究form表单</span></span><br><span class="line">默认的数据编码格式是: urlencoded</span><br><span class="line">数据格式: username=zhangsan&amp;password=<span class="number">123</span></span><br><span class="line">django后端针对符合urlencoded编码格式的数据都会自动解析封装到request.POST中</span><br><span class="line"></span><br><span class="line">如果你把编码格式改为formdate, 那么针对普通的键值对还是解析到request.POST中,而文件解析到request.FILES中</span><br><span class="line"></span><br><span class="line">form表单是无法发送json格式的数据的</span><br><span class="line"></span><br><span class="line"><span class="comment"># 研究ajax</span></span><br><span class="line">默认的编码格式: urlencoded</span><br><span class="line">数据格式: username=zhangsan&amp;password=<span class="number">123</span></span><br></pre></td></tr></table></figure>

<h2 id="ajax发送json格式数据"><a href="#ajax发送json格式数据" class="headerlink" title="ajax发送json格式数据"></a>ajax发送json格式数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">前后端传输数据的时候一定要确保编码格式跟数据真正的格式是一致的</span></span><br><span class="line"><span class="string">不要骗人家!!!</span></span><br><span class="line"><span class="string">&#123;&quot;username&quot;:&quot;zhangsan&quot;,&quot;password&quot;:123&#125; ==&gt; 在request.POST里面肯定拿不到</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">$(<span class="string">&#x27;#d1&#x27;</span>).click(function()&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data:JSON.stringify(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>&#125;),</span><br><span class="line">            contentType:<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">            success:function()&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request对象方法补充: </span><br><span class="line">    request.is_ajax()</span><br><span class="line">    判断当前请求是否为ajax请求 返回<span class="built_in">bool</span>值</span><br><span class="line">django对待json格式的数据不会做任何的处理,全部存储在request.body中,是一个二进制的json字符串</span><br><span class="line">需要我们自己手动处理</span><br><span class="line">json_bytes = request.body</span><br><span class="line">json_str = json_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">json_dict = json.loads(json_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json_loads括号内如果传入一个二进制格式的数据,那么内部会自动解码,然后反序列化</span></span><br><span class="line">json_dict = json.loads(json_bytes)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: ajax发送json格式数据需要注意以下几点</p>
<ol>
<li>contentType参数需要指定为: application&#x2F;json</li>
<li>数据是真正的json格式</li>
<li>django后端不会帮你处理json格式的数据,需要自己去request.body中获取并处理</li>
</ol>
</blockquote>
<h2 id="ajax发送文件"><a href="#ajax发送文件" class="headerlink" title="ajax发送文件"></a>ajax发送文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ajax发送文件需要借助于js内置对象 FormData</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 前端</span></span><br><span class="line">// 点击按钮想后端发送普通键值对和文件数据</span><br><span class="line">$(<span class="string">&#x27;#d4&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>,function()&#123;</span><br><span class="line">    // <span class="number">1.</span> 需要先利用FormData内置对象</span><br><span class="line">    let formDataObj = new FormData();</span><br><span class="line">    // <span class="number">2.</span> 添加普通的键值对</span><br><span class="line">    formDataObj.append(<span class="string">&#x27;username&#x27;</span>,$(<span class="string">&#x27;#d1&#x27;</span>).val());</span><br><span class="line">    formDataObj.append(<span class="string">&#x27;password&#x27;</span>,$(<span class="string">&#x27;#d2&#x27;</span>).val());</span><br><span class="line">    // <span class="number">3.</span> 添加文件对象</span><br><span class="line">    formDataObj.append(<span class="string">&#x27;myfile&#x27;</span>,$(<span class="string">&#x27;#d3&#x27;</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">    // <span class="number">4.</span> 将对象基于ajax发送给后端</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="built_in">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data:formDataObj,</span><br><span class="line">        //ajax发送文件必须指定两个参数</span><br><span class="line">        contentType:false, // 不需要使用任何编码 django后端自动识别formdata对象</span><br><span class="line">        processData: false, // 告诉浏览器不要对你的数据进行任何处理</span><br><span class="line">        success: function (&#123;</span><br><span class="line"></span><br><span class="line">                           &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment"># 后端 数据依旧存储在request.POST,request.FILES中</span></span><br></pre></td></tr></table></figure>

<h2 id="django自带的序列化组件-drf做铺垫"><a href="#django自带的序列化组件-drf做铺垫" class="headerlink" title="django自带的序列化组件(drf做铺垫)"></a>django自带的序列化组件(drf做铺垫)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需求: 在前端获取到后端用户表里的所有数据 并且要是列表套字典格式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ser</span>(<span class="params">request</span>):</span><br><span class="line">    users = models.User.objects.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># [&#123;&#125;,&#123;&#125;,&#123;&#125;]</span></span><br><span class="line">    <span class="comment"># user_list = []</span></span><br><span class="line">    <span class="comment"># for user in users:</span></span><br><span class="line">    <span class="comment">#     tmp = &#123;</span></span><br><span class="line">    <span class="comment">#         &#x27;pk&#x27;: user.pk,</span></span><br><span class="line">    <span class="comment">#         &#x27;username&#x27;: user.username,</span></span><br><span class="line">    <span class="comment">#         &#x27;age&#x27;: user.age,</span></span><br><span class="line">    <span class="comment">#         &#x27;gender&#x27;: user.get_gender_display()</span></span><br><span class="line">    <span class="comment">#     &#125;</span></span><br><span class="line">    <span class="comment">#     user_list.append(tmp)</span></span><br><span class="line">    <span class="comment"># return JsonResponse(user_list, safe=False)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    [</span></span><br><span class="line"><span class="string">        &#123;&quot;pk&quot;: 1, &quot;username&quot;: &quot;jason&quot;, &quot;age&quot;: 18, &quot;gender&quot;: &quot;male&quot;&#125;,</span></span><br><span class="line"><span class="string">        &#123;&quot;pk&quot;: 2, &quot;username&quot;: &quot;egon&quot;, &quot;age&quot;: 19, &quot;gender&quot;: &quot;female&quot;&#125;,</span></span><br><span class="line"><span class="string">        &#123;&quot;pk&quot;: 3, &quot;username&quot;: &quot;tank&quot;, &quot;age&quot;: 17, &quot;gender&quot;: &quot;male&quot;&#125;,</span></span><br><span class="line"><span class="string">        &#123;&quot;pk&quot;: 4, &quot;username&quot;: &quot;kivin&quot;, &quot;age&quot;: 20, &quot;gender&quot;: 3&#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">    # 前后端分离项目</span></span><br><span class="line"><span class="string">    作为后端的你只需要写代码并且将数据处理好</span></span><br><span class="line"><span class="string">    能够序列化返回给前段即可</span></span><br><span class="line"><span class="string">    再写一个接口文档</span></span><br><span class="line"><span class="string">    告诉前端每一个字段代表什么意思即可</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 序列化</span></span><br><span class="line">    res = serializers.serialize(<span class="string">&#x27;json&#x27;</span>,users)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(res)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;会自动帮你把数据变成json格式的字符串并且内部非常的全面&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  [&#123;&quot;model&quot;: &quot;app01.user&quot;, &quot;pk&quot;: 1, &quot;fields&quot;: &#123;&quot;username&quot;: &quot;jason&quot;, &quot;age&quot;: 18, &quot;gender&quot;: 1&#125;&#125;, &#123;&quot;model&quot;: &quot;app01.user&quot;, &quot;pk&quot;: 2, &quot;fields&quot;: &#123;&quot;username&quot;: &quot;egon&quot;, &quot;age&quot;: 19, &quot;gender&quot;: 2&#125;&#125;, &#123;&quot;model&quot;: &quot;app01.user&quot;, &quot;pk&quot;: 3, &quot;fields&quot;: &#123;&quot;username&quot;: &quot;tank&quot;, &quot;age&quot;: 17, &quot;gender&quot;: 1&#125;&#125;, &#123;&quot;model&quot;: &quot;app01.user&quot;, &quot;pk&quot;: 4, &quot;fields&quot;: &#123;&quot;username&quot;: &quot;kivin&quot;, &quot;age&quot;: 20, &quot;gender&quot;: 3&#125;&#125;]</span></span><br><span class="line"><span class="string">    写接口的就是利用序列化组件 渲染数据然后写一个借口文档 该交代的交代一下就行了</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 批量插入 bulk_create()</span></span><br><span class="line">book_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    book = models.Book(title=<span class="string">&#x27;第%s本书&#x27;</span>%i)</span><br><span class="line">    book_list.append(book)</span><br><span class="line">models.Book.objects.bulk_create(book_list)</span><br><span class="line">books = models.Book.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">&#x27;ab_pi.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h2 id="自定义分页器"><a href="#自定义分页器" class="headerlink" title="自定义分页器"></a>自定义分页器</h2><p>基于bootstrap实现,使用之前需要导入bootstrap</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pagination</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, current_page, all_count, per_page_num=<span class="number">10</span>, pager_count=<span class="number">11</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        封装分页相关数据</span></span><br><span class="line"><span class="string">        :param current_page: 当前页</span></span><br><span class="line"><span class="string">        :param all_count:    数据库中的数据总条数</span></span><br><span class="line"><span class="string">        :param per_page_num: 每页显示的数据条数</span></span><br><span class="line"><span class="string">        :param pager_count:  最多显示的页码个数</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            current_page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        self.current_page = current_page</span><br><span class="line"></span><br><span class="line">        self.all_count = all_count</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 总页码</span></span><br><span class="line">        all_pager, tmp = <span class="built_in">divmod</span>(all_count, per_page_num)</span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            all_pager += <span class="number">1</span></span><br><span class="line">        self.all_pager = all_pager</span><br><span class="line"></span><br><span class="line">        self.pager_count = pager_count</span><br><span class="line">        self.pager_count_half = <span class="built_in">int</span>((pager_count - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">end</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">page_html</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 如果总页码 &lt; 11个：</span></span><br><span class="line">        <span class="keyword">if</span> self.all_pager &lt;= self.pager_count:</span><br><span class="line">            pager_start = <span class="number">1</span></span><br><span class="line">            pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 总页码  &gt; 11</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 当前页如果&lt;=页面上最多显示11/2个页码</span></span><br><span class="line">            <span class="keyword">if</span> self.current_page &lt;= self.pager_count_half:</span><br><span class="line">                pager_start = <span class="number">1</span></span><br><span class="line">                pager_end = self.pager_count + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 当前页大于5</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 页码翻到最后</span></span><br><span class="line">                <span class="keyword">if</span> (self.current_page + self.pager_count_half) &gt; self.all_pager:</span><br><span class="line">                    pager_end = self.all_pager + <span class="number">1</span></span><br><span class="line">                    pager_start = self.all_pager - self.pager_count + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pager_start = self.current_page - self.pager_count_half</span><br><span class="line">                    pager_end = self.current_page + self.pager_count_half + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        page_html_list = []</span><br><span class="line">        <span class="comment"># 添加前面的nav和ul标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;nav aria-label=&#x27;Page navigation&gt;&#x27;</span></span><br><span class="line"><span class="string">                    &lt;ul class=&#x27;pagination&#x27;&gt;</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        first_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (<span class="number">1</span>)</span><br><span class="line">        page_html_list.append(first_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &lt;= <span class="number">1</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;上一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page - <span class="number">1</span>,)</span><br><span class="line"></span><br><span class="line">        page_html_list.append(prev_page)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pager_start, pager_end):</span><br><span class="line">            <span class="keyword">if</span> i == self.current_page:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (i, i,)</span><br><span class="line">            page_html_list.append(temp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.current_page &gt;= self.all_pager:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li class=&quot;disabled&quot;&gt;&lt;a href=&quot;#&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            next_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;下一页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.current_page + <span class="number">1</span>,)</span><br><span class="line">        page_html_list.append(next_page)</span><br><span class="line"></span><br><span class="line">        last_page = <span class="string">&#x27;&lt;li&gt;&lt;a href=&quot;?page=%s&quot;&gt;尾页&lt;/a&gt;&lt;/li&gt;&#x27;</span> % (self.all_pager,)</span><br><span class="line">        page_html_list.append(last_page)</span><br><span class="line">        <span class="comment"># 尾部添加标签</span></span><br><span class="line">        page_html_list.append(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                                           &lt;/nav&gt;</span></span><br><span class="line"><span class="string">                                           &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                                       &#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(page_html_list)</span><br></pre></td></tr></table></figure>

<h2 id="form组件"><a href="#form组件" class="headerlink" title="form组件"></a>form组件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">写一个注册功能</span></span><br><span class="line"><span class="string">	获取用户名和密码 利用form表单提交数据</span></span><br><span class="line"><span class="string">	在后端判断用户名和密码是否符合一定的条件</span></span><br><span class="line"><span class="string">		用户名不能含有金瓶梅</span></span><br><span class="line"><span class="string">		密码不能少于三位数</span></span><br><span class="line"><span class="string">	如果符合条件需要你讲提示信息展示到前端页面</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;p&gt;username: &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">    &lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; back_dict.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;password: &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">    &lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; back_dict.password &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 手动书写前端获取用户数据的html代码		渲染html代码</span></span><br><span class="line"><span class="string">2. 后端对用户数据的校验					校验数据</span></span><br><span class="line"><span class="string">3. 对不符合要求的数据进行前端提示			展示提示信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">form组件</span></span><br><span class="line"><span class="string">	能够完成的事情</span></span><br><span class="line"><span class="string">	1. 渲染HTML代码</span></span><br><span class="line"><span class="string">	2. 校验数据</span></span><br><span class="line"><span class="string">	3. 展示提示信息</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">为什么数据校验一定要去后端	不能在前端利用js直接完成呢?</span></span><br><span class="line"><span class="string">	数据校验前端可有可无</span></span><br><span class="line"><span class="string">	但是后端必须要有!!!</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	因为前端的校验是弱不禁风的 你可以直接修改</span></span><br><span class="line"><span class="string">	或者利用爬虫程序绕过前端页面直接朝后端提交数据</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="form组件校验数据"><a href="#form组件校验数据" class="headerlink" title="form组件校验数据"></a>form组件校验数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本使用</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyForm</span>(forms.Form):</span><br><span class="line">    username = forms.CharField(min_length=<span class="number">3</span>,max_length=<span class="number">8</span>)</span><br><span class="line">    password = forms.CharField(min_length=<span class="number">6</span>,max_length=<span class="number">12</span>)</span><br><span class="line">    email = forms.EmailField()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 测试环境的准备 可以拷贝代码准备</span></span><br><span class="line"><span class="string">2. 其实pycharm里面已经准备好了一个测试环境 Python console</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"><span class="comment"># 1. 强带校验的数据组织成字典的形式传入即可</span></span><br><span class="line">form_obj = views.MyForm(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123</span>,<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;123&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 2. 判断数据是否合法 注意该方法只有在所有的字段都是合法的时候才会返回True</span></span><br><span class="line">form_obj.is_valid()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="comment"># 3. 查看多有符合校验规则的数据</span></span><br><span class="line">form_obj.cleaned_data</span><br><span class="line">&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># 4. 查看所有不符合校验规则以及不符合的原因</span></span><br><span class="line">form_obj.errors</span><br><span class="line">&#123;<span class="string">&#x27;password&#x27;</span>: [<span class="string">&#x27;Ensure this value has at least 6 characters (it has 3).&#x27;</span>], <span class="string">&#x27;email&#x27;</span>: [<span class="string">&#x27;Enter a valid email address.&#x27;</span>]&#125;</span><br><span class="line"><span class="comment"># 5. 校验数据只校验定义的字段,多传入的字段不做校验</span></span><br><span class="line">form_obj = views.MyForm(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="number">123567</span>,<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;123@qq.com&#x27;</span>,<span class="string">&#x27;hobby&#x27;</span>:<span class="string">&#x27;study&#x27;</span>&#125;)</span><br><span class="line">form_obj.is_valid()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment"># 6. 校验数据 类里面所有的字段都必须传值</span></span><br><span class="line">form_obj = views.MyForm(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123456&#x27;</span>&#125;)</span><br><span class="line">form_obj.is_valid()</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>也就意味着 默认情况下数据可以多传,但是不可以少</p>
</blockquote>
<h3 id="forms组件-渲染标签"><a href="#forms组件-渲染标签" class="headerlink" title="forms组件 渲染标签"></a>forms组件 渲染标签</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">forms组件只会自动帮你渲染获取用户输入的标签(input,select,radio,checkbox)</span></span><br><span class="line"><span class="string">不会帮助你渲染按钮</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 前端</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;p&gt;第一种渲染方式:代码书写极少,封装程度太高 不利于后续得到扩展 一般情况下只在本地测试使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_p &#125;&#125;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_ul &#125;&#125;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_table &#125;&#125;#&#125;</span></span><br><span class="line">    &lt;p&gt;第二种渲染方式: 可扩展性很强,但是需要书写的代码太多 一般情况下不使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.username.label &#125;&#125;:&#123;&#123; form_obj.username &#125;&#125;#&#125;</span></span><br><span class="line">    &lt;p&gt;第三种渲染方式: 推荐使用&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment"># 后端</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 1. 先产生一个空对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>label属性默认战士的是类中定义的字段的首字母大写的形式</p>
<p>也可以自己修改,需要在字段后面添加label属性</p>
</blockquote>
<h3 id="forms组件-展示提示信息"><a href="#forms组件-展示提示信息" class="headerlink" title="forms组件 展示提示信息"></a>forms组件 展示提示信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">浏览器还自动帮你校验数据 但是前端的校验弱不禁风</span></span><br><span class="line"><span class="string">如何让浏览器不做校验</span></span><br><span class="line"><span class="string">需要在form表单中添加属性  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 1. 先产生一个空对象</span></span><br><span class="line">    form_obj = MyForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 1. 获取用户数据并且校验</span></span><br><span class="line">        <span class="comment"># 2. 校验数据需要构造成字典的格式传入才行</span></span><br><span class="line">        <span class="comment"># ps: request.POST可以看成一个字典</span></span><br><span class="line">        <span class="comment"># 3. 校验数据</span></span><br><span class="line">        form_obj = MyForm(request.POST)</span><br><span class="line">        <span class="comment"># 4.判断数据是否合法</span></span><br><span class="line">        <span class="comment"># 5. 如果合法 操作数据福存储数据</span></span><br><span class="line">        <span class="keyword">if</span> form_obj.is_valid():</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">        <span class="comment"># 5. 如果不合法 有错误</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> novalidate&gt;</span><br><span class="line">    &lt;p&gt;第一种渲染方式:代码书写极少,封装程度太高 不利于后续得到扩展 一般情况下只在本地测试使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_p &#125;&#125;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_ul &#125;&#125;#&#125;</span></span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.as_table &#125;&#125;#&#125;</span></span><br><span class="line">    &lt;p&gt;第二种渲染方式: 可扩展性很强,但是需要书写的代码太多 一般情况下不使用&lt;/p&gt;</span><br><span class="line">&#123;<span class="comment">#    &#123;&#123; form_obj.username.label &#125;&#125;:&#123;&#123; form_obj.username &#125;&#125;#&#125;</span></span><br><span class="line">    &lt;p&gt;第三种渲染方式: 推荐使用&lt;/p&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> form <span class="keyword">in</span> form_obj %&#125;</span><br><span class="line">        &lt;p&gt;&#123;&#123; form.label &#125;&#125;:&#123;&#123; form &#125;&#125;</span><br><span class="line">        &lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; form.errors<span class="number">.0</span> &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;btn btn-info&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: </p>
<ol>
<li>必备的条件: get请求和post请求传给html页面对象变量名必须要一样</li>
<li><ol start="2">
<li>forms组件当你的数据不合法的情况下 会保存你上一次的数据 让你基于原来的结果进行修改 更加的人性化</li>
</ol>
</li>
</ol>
<p>针对错误信息还可以自定义定制:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">password = forms.CharField(min_length=<span class="number">6</span>, max_length=<span class="number">12</span>, label=<span class="string">&#x27;密码&#x27;</span>, error_messages=&#123;</span><br><span class="line">        <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;密码至少三位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;密码最多八位&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;密码不能为空&#x27;</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="钩子函数-HOOK"><a href="#钩子函数-HOOK" class="headerlink" title="钩子函数(HOOK)"></a>钩子函数(HOOK)</h3><p>在特定的节点自动触发完成响应操作,钩子函数在forms组件中相当于第二道关卡, 能够让我们自定义校验规则</p>
<p>在forms组件内有两种钩子:</p>
<ul>
<li><p>局部钩子</p>
<p>当你需要给某个字段增加校验规则的时候可以使用</p>
</li>
<li><p>全局钩子</p>
<p>让你需要给多个字段增加校验规则的时候可以使用</p>
</li>
</ul>
<p>实际案例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 校验用户名汇总不能含有666		只校验username字段	局部钩子</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 校验密码和确认密码是否一致		校验password和repassword两个字段	全局钩子</span></span><br></pre></td></tr></table></figure>

<h3 id="forms组件其它参数以及补充知识点"><a href="#forms组件其它参数以及补充知识点" class="headerlink" title="forms组件其它参数以及补充知识点"></a>forms组件其它参数以及补充知识点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">label: 字段名</span><br><span class="line">error_messages: 自定义报错信息</span><br><span class="line">initial: 相当于form标签里的value,提供默认值</span><br><span class="line">required: 控制字段是否必填</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 字段没有样式</span></span><br><span class="line"><span class="string">2. 针对不同的input如何修改?</span></span><br><span class="line"><span class="string">	text</span></span><br><span class="line"><span class="string">	password</span></span><br><span class="line"><span class="string">	date</span></span><br><span class="line"><span class="string">	radio</span></span><br><span class="line"><span class="string">	checkbox</span></span><br><span class="line"><span class="string">	...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">widget=forms.widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">widget=forms.widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">还支持正则校验</span><br><span class="line">validators=[</span><br><span class="line">            RegexValidator(<span class="string">r&#x27;^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d&#123;8&#125;$&#x27;</span>,<span class="string">&#x27;手机号格式不正确&#x27;</span>),</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 其他类型渲染</span></span><br><span class="line"><span class="comment"># radio</span></span><br><span class="line">gender = forms.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>,<span class="string">&#x27;male&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;female&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;secret&#x27;</span>)),</span><br><span class="line">    label=<span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    initial=<span class="number">3</span>,</span><br><span class="line">    widget=forms.widgets.RadioSelect()</span><br><span class="line">)</span><br><span class="line"><span class="comment"># select</span></span><br><span class="line">hobby = forms.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>,<span class="string">&#x27;篮球&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;足球&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;双色球&#x27;</span>)),</span><br><span class="line">    label=<span class="string">&#x27;爱好&#x27;</span>,</span><br><span class="line">    initial=<span class="number">3</span>,</span><br><span class="line">    widget=forms.widgets.Select()</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 多选select</span></span><br><span class="line">hobby1 = forms.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>, <span class="string">&#x27;篮球&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;足球&#x27;</span>), (<span class="number">3</span>, <span class="string">&#x27;双色球&#x27;</span>)),</span><br><span class="line">    label=<span class="string">&#x27;爱好&#x27;</span>,</span><br><span class="line">    initial=[<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">    widget=forms.widgets.SelectMultiple()</span><br><span class="line">)</span><br><span class="line"><span class="comment"># checkbox</span></span><br><span class="line">keep = forms.ChoiceField(</span><br><span class="line">    label=<span class="string">&#x27;是否记住密码&#x27;</span>,</span><br><span class="line">    initial=<span class="string">&#x27;checked&#x27;</span>,</span><br><span class="line">    widget=forms.widgets.CheckboxInput()</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 多选checkbox</span></span><br><span class="line">hobby2 = forms.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>, <span class="string">&#x27;篮球&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;足球&#x27;</span>), (<span class="number">3</span>, <span class="string">&#x27;双色球&#x27;</span>)),</span><br><span class="line">    label=<span class="string">&#x27;爱好&#x27;</span>,</span><br><span class="line">    initial=[<span class="number">1</span>, <span class="number">3</span>],</span><br><span class="line">    widget=forms.widgets.CheckboxSelectMultiple()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="forms组件源码"><a href="#forms组件源码" class="headerlink" title="forms组件源码"></a>forms组件源码</h3><h2 id="cookie与session"><a href="#cookie与session" class="headerlink" title="cookie与session"></a>cookie与session</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">发展史:</span></span><br><span class="line"><span class="string">	1. 网站都没有保存用户功能的需求	所有用户访问返回的结果都是一样的</span></span><br><span class="line"><span class="string">		eg: 新闻,博客...</span></span><br><span class="line"><span class="string">	2. 出现了一些需要保存用户信息的网站</span></span><br><span class="line"><span class="string">		eg: 淘宝,支付宝...</span></span><br><span class="line"><span class="string">    以登录功能为例: 如果不保存用户登录状态 也就意味着用户每次访问网站都需要重复输入用户名和密码</span></span><br><span class="line"><span class="string">    当用户第一次登陆之后 将用户的用户名和密码返回给用户浏览器 让用户浏览器保存在本地,之后访问网站的时候浏览器自动将保存在浏览器上的用户名和密码发送给服务端,服务端获取之后进行验证</span></span><br><span class="line"><span class="string">    早起这种方式具有非常大的安全隐患</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    优化: </span></span><br><span class="line"><span class="string">    	当用户登陆成功之后,服务端产生一个随机字符串(在服务端保存数据,用kv键值对的形式),交由客户端保存</span></span><br><span class="line"><span class="string">    	之后访问服务端的时候都带着该随机字符串,服务端去数据库中对比是否有对应的随机字符串从而获取对应的用户信息</span></span><br><span class="line"><span class="string">    	</span></span><br><span class="line"><span class="string">    但是,如果你拿到了截获到的随机字符串,那么你就可以充当当前用户 其实还是存在安全隐患的</span></span><br><span class="line"><span class="string">    要知道的是,在web领域没有绝对安全的安全,也没有绝对的不安全</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">cookie</span><br><span class="line">	服务端保存在客户端浏览器删的信息都称之为cookie</span><br><span class="line">    他的表现形式为kv键值对</span><br><span class="line">session</span><br><span class="line">	数据是保存在服务端的并且它的表现形式也是kv键值对</span><br><span class="line">token</span><br><span class="line">	session虽然是保存在服务端的,但是禁不住数据量大</span><br><span class="line">    服务端不在保存数据</span><br><span class="line">    	登陆成功之后 将一段数据进行加密处理</span><br><span class="line">jwt认证</span><br><span class="line">	三段信息</span><br><span class="line">    (后期)</span><br><span class="line">总结:</span><br><span class="line">    <span class="number">1.</span> cookie就是保存在客户端浏览器上的信息</span><br><span class="line">    <span class="number">2.</span> session就是保存在服务端上的信息</span><br><span class="line">    <span class="number">3.</span> session是基于cookie工作的</span><br></pre></td></tr></table></figure>

<h3 id="cookie操作"><a href="#cookie操作" class="headerlink" title="cookie操作"></a>cookie操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 视图函数的返回值</span></span><br><span class="line"><span class="keyword">return</span> render()</span><br><span class="line"><span class="keyword">return</span> HttpResponse()</span><br><span class="line"><span class="keyword">return</span> redirect()</span><br><span class="line"></span><br><span class="line">obj1 = render()</span><br><span class="line">obj2 = HttpResponse()</span><br><span class="line">obj3 = redirect()</span><br><span class="line"><span class="keyword">return</span> obj1</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 如果你想要操作cookie, 就必须要写下面的这种方式obj对象</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">设置cookie</span></span><br><span class="line"><span class="string">obj.set_cookie(key,value)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">获取cookie</span></span><br><span class="line"><span class="string">request.COOKIES.get(key)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">max_age</span></span><br><span class="line"><span class="string">expires</span></span><br><span class="line"><span class="string">	两者都是设置超时的参数,都是以秒为单位的</span></span><br><span class="line"><span class="string">	ie浏览器使用expires</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">delete_cookie() 用来删除cookie</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_auth</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">request,*args,**kwargs</span>):</span><br><span class="line">        <span class="comment"># print(request.path_info)</span></span><br><span class="line">        <span class="comment"># print(request.get_full_path())  # 能够获取到用户上一次想要访问的url</span></span><br><span class="line">        target_url = request.get_full_path()</span><br><span class="line">        <span class="keyword">if</span> request.COOKIES.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> func(request,*args,**kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/?next=%s&#x27;</span>%target_url)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;jason&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 获取用户上一次想要访问的url</span></span><br><span class="line">            target_url = request.GET.get(<span class="string">&#x27;next&#x27;</span>)  <span class="comment"># 这个结果可能是None</span></span><br><span class="line">            <span class="keyword">if</span> target_url:</span><br><span class="line">                obj = redirect(target_url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 保存用户登陆状态</span></span><br><span class="line">                obj = redirect(<span class="string">&#x27;/home/&#x27;</span>)</span><br><span class="line">            <span class="comment"># 让浏览器记录cookie数据</span></span><br><span class="line">            obj.set_cookie(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;jason666&#x27;</span>)</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            浏览器不单单会帮你存</span></span><br><span class="line"><span class="string">            而且后面每次访问你的时候还会带着它过来</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># 跳转到一个需要用户登陆之后才能看的页面</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_auth</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 获取cookie信息 判断你有没有</span></span><br><span class="line">    <span class="comment"># if request.COOKIES.get(&#x27;username&#x27;) == &#x27;jason666&#x27;:</span></span><br><span class="line">    <span class="comment">#     return HttpResponse(&quot;我是home页面，只有登陆的用户才能进来哟~&quot;)</span></span><br><span class="line">    <span class="comment"># # 没有登陆应该跳转到登陆页面</span></span><br><span class="line">    <span class="comment"># return redirect(&#x27;/login/&#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;我是home页面，只有登陆的用户才能进来哟~&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_auth</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(<span class="params">request</span>):</span><br><span class="line">    obj = redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line">    obj.delete_cookie(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="session操作"><a href="#session操作" class="headerlink" title="session操作"></a>session操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">session数据是保存在服务端的,给客户端返回的是一个随机字符串</span></span><br><span class="line"><span class="string">	sessionid:随机字符串</span></span><br><span class="line"><span class="string">1. 在默认情况下操作session的时候需要django默认的一张django_session表</span></span><br><span class="line"><span class="string">django默认的session的过期时间是14天</span></span><br><span class="line"><span class="string">	 </span></span><br><span class="line"><span class="string">设置session</span></span><br><span class="line"><span class="string">request.session[&#x27;key&#x27;] = value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">获取session</span></span><br><span class="line"><span class="string">request.session.get(&#x27;key&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># django_session表中的数据条数是取决于浏览器的 同一个计算机上的同一个浏览器只会有一条数据生效</span></span><br><span class="line"><span class="comment"># 主要是为了节省服务端资源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置过期时间</span></span><br><span class="line">request.session.set_expiry()</span><br><span class="line">	括号内可以存放四种类型参数</span><br><span class="line">    <span class="number">1.</span> 整数	秒</span><br><span class="line">    <span class="number">2.</span> 实践对象		到指定的日期就失效</span><br><span class="line">    <span class="number">3.</span> <span class="number">0</span>	浏览器一关闭就立刻失效</span><br><span class="line">    <span class="number">4.</span> 不写	默认<span class="number">14</span>天</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 清楚session</span></span><br><span class="line">request.session.delete() <span class="comment"># 删除当前会话所有的session 只删除服务端</span></span><br><span class="line">request.session.flush() <span class="comment"># 浏览器和服务端都清空(常用)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># session是保存在服务端的,但是session保存的位置可以有多种选择</span></span><br><span class="line"><span class="number">1.</span> mysql</span><br><span class="line"><span class="number">2.</span> 文件</span><br><span class="line"><span class="number">3.</span> redis</span><br><span class="line"><span class="number">4.</span> memcache</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="CBV如何添加装饰器"><a href="#CBV如何添加装饰器" class="headerlink" title="CBV如何添加装饰器"></a>CBV如何添加装饰器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">cbv中django不建议你直接给类方法直接添加装饰器</span></span><br><span class="line"><span class="string">无论装饰器能否正常使用</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @method_decorator(login_auth,name=&#x27;get&#x27;) # 方式二(可以添加多个针对不同的方法加不同的装饰器)</span></span><br><span class="line"><span class="comment"># @method_decorator(login_auth,name=&#x27;post&#x27;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLogin</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">login_auth</span>)  </span><span class="comment"># 方式三: 他会直接作用于当前类里面所有的方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># @method_decorator(login_auth) # 方式一: 指名道姓</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get请求&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post请求&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="django中间件"><a href="#django中间件" class="headerlink" title="django中间件"></a>django中间件</h2><p>首先 django自带七个中间件, 每个中间件都是各自对应的功能</p>
<p>并且django还支持程序员自定义中间件</p>
<p>你在用django开发项目的项目的时候,只要是涉及到全局相关写功能都可以使用中间件方便的完成</p>
<ul>
<li>全局用户身份校验</li>
<li>全局用户权限校验</li>
<li>全局访问频率校验</li>
<li>…</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django中间件是django的门户</span></span><br><span class="line"><span class="string">1. 请求来的时候需要先经过中间件才能真正的到达django后端</span></span><br><span class="line"><span class="string">2. 响应走的时候最后也需要经过中间件才能发送出去</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="django请求生命周期流程图"><a href="#django请求生命周期流程图" class="headerlink" title="django请求生命周期流程图"></a>django请求生命周期流程图</h3><p>![image-20210701071459432](C:\Users\evans\Documents\Typora\web-backend-learning\03 Django高级.assets\image-20210701071459432.png)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SessionMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)</span><br><span class="line">        request.session = self.SessionStore(session_key)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CsrfViewMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">  	<span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        csrf_token = self._get_token(request)</span><br><span class="line">        <span class="keyword">if</span> csrf_token <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># Use same token next time.</span></span><br><span class="line">            request.META[<span class="string">&#x27;CSRF_COOKIE&#x27;</span>] = csrf_token</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self, request, callback, callback_args, callback_kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> self._accept(request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthenticationMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        request.user = SimpleLazyObject(<span class="keyword">lambda</span>: get_user(request))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">django支持程序员自定义中间件并且暴露给程序员五个可以自定义的方法</span></span><br><span class="line"><span class="string">	1.必须掌握</span></span><br><span class="line"><span class="string">		process_request</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">		process_response</span></span><br><span class="line"><span class="string">	2.了解即可</span></span><br><span class="line"><span class="string">		process_view</span></span><br><span class="line"><span class="string">			</span></span><br><span class="line"><span class="string">		process_template_response</span></span><br><span class="line"><span class="string">		</span></span><br><span class="line"><span class="string">		process_exception</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="如何自定义中间件"><a href="#如何自定义中间件" class="headerlink" title="如何自定义中间件"></a>如何自定义中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;我是第一个自定义中间件里面的process_request方法&#x27;</span>)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># def process_response(self,request):</span></span><br><span class="line">    <span class="comment">#     pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMiddleware1</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;我是第二个自定义中间件里面的process_request方法&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMiddleware2</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;我是第三个自定义中间件里面的process_request方法&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.mymiddleware.mymiddleware.MyMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.mymiddleware.mymiddleware.MyMiddleware1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.mymiddleware.mymiddleware.MyMiddleware2&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># django支持程序员自定义中间件并且暴露给程序员五个可以自定义的方法</span></span><br><span class="line"><span class="number">1.</span>必须掌握</span><br><span class="line">    process_request 最常用</span><br><span class="line">        <span class="number">1</span> 请求来的时候经过每一个中间件里面的process_request方法</span><br><span class="line">        结果的顺序是按照配置文件中注册的中间件顺序来的</span><br><span class="line">        <span class="number">2</span> 如果中间件里面没有定义该方法,那么直接跳过执行下一个中间件</span><br><span class="line">        <span class="number">3</span> 如果该方法返回了HTTPResponse对象,那么请求将不会继续往后执行,而是原路返回(相当于校验失败不允许访问...)</span><br><span class="line"></span><br><span class="line">        所以process_request方法就是用来做全局相关的所有限制功能</span><br><span class="line">    process_response</span><br><span class="line">         <span class="number">1</span> 响应走的时候需要经过每一个中间件里的该方法</span><br><span class="line">        该方法有两个参数request,response</span><br><span class="line">        <span class="number">2</span> 该方法必须返回一个HTTPResponse对象</span><br><span class="line">            <span class="number">2.1</span> 默认返回response</span><br><span class="line">            <span class="number">2.2</span> 你也可以返回自己定义的</span><br><span class="line">         <span class="number">3</span> 顺序是按照配置文件中注册的中间件从下至上依次执行, 如果你没有定义的话,那么直接跳过</span><br><span class="line"></span><br><span class="line">     研究如果在第一个process_request方法就已经返回了HTTPResponse对象,那么响应走的时候是经过所有的中间件里面的process_response还是其他情况?</span><br><span class="line">     是其他情况: 直接走同级别的process_response,然后原路返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     flask框架也有一个中间件但是他的规律不一样: 只要返回数据了就必须经过所有中间件里面类似于process_response方法</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>了解即可</span><br><span class="line">		process_view</span><br><span class="line">			在路由匹配成功之后执行视图函数之前,会自动中间件里的方法</span><br><span class="line">        	<span class="keyword">def</span> <span class="title function_">process_view</span>(<span class="params">self,request,view_name,*args,**kargs</span>)</span><br><span class="line">		process_template_response</span><br><span class="line">			返回的HTTPResponse对象有render属性的时候才会触发</span><br><span class="line">		process_exception</span><br><span class="line">        	<span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self,request,exception</span>)</span><br><span class="line">            当视图函数出现异常的情况下触发</span><br></pre></td></tr></table></figure>

<h3 id="csrf跨站请求伪造"><a href="#csrf跨站请求伪造" class="headerlink" title="csrf跨站请求伪造"></a>csrf跨站请求伪造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">钓鱼网站</span></span><br><span class="line"><span class="string">	我搭建一个跟正规网站一模一样的界面(中国银行)</span></span><br><span class="line"><span class="string">	用户不小心进入到我们的网站,用户给某个人</span></span><br><span class="line"><span class="string">	打钱的操作确确实实是提交给中国银行的系统,用户的钱也确确实实减少了</span></span><br><span class="line"><span class="string">	但是唯一不同的时候打钱的账户不使用用户要打钱的账户变成了其他人的账户</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">内部本质</span></span><br><span class="line"><span class="string">	我们在钓鱼网站的页面 针对对方账户 只给用户提供一个没有name属性的普通input框</span></span><br><span class="line"><span class="string">	然后我们在内部隐藏一个已经写好了的name和value的input框</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">如何规避上述问题</span></span><br><span class="line"><span class="string">	csrf跨站请求伪造</span></span><br><span class="line"><span class="string">	网站在给用户返回一个具有提交数据功能页面的时候会给这个页面加一个唯一标识</span></span><br><span class="line"><span class="string">	当这个页面朝后端发送post请求的时候 我的后端会先校验唯一标识,如果唯一标识不对直接拒绝(403 forbidden)如果正确则正常执行</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="如何符合校验"><a href="#如何符合校验" class="headerlink" title="如何符合校验"></a>如何符合校验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模板语言 form表单如何符合校验</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;col-md-10&quot;</span>&gt;</span><br><span class="line">        &#123;% csrf_token %&#125;</span><br><span class="line">        &lt;p&gt;username: &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;target_user: &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;target_user&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;money: &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;money&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ajax如何符合校验</span></span><br><span class="line">$(<span class="string">&#x27;#d1&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="comment">// 第一种 利用标签查找获取页面上的随机字符串</span></span><br><span class="line">            &#123;#<span class="attr">data</span>:&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:$(<span class="string">&#x27;[name=&quot;csrfmiddlewaretoken&quot;]&#x27;</span>).<span class="title function_">val</span>()&#125;,#&#125;</span><br><span class="line">            <span class="comment">// 第二种 使用模板语法</span></span><br><span class="line">            &#123;#<span class="attr">data</span>:&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;csrfmiddlewaretoken&#x27;</span>:<span class="string">&#x27;&#123;&#123; csrf_token &#125;&#125;&#x27;</span>&#125;,#&#125;</span><br><span class="line">            <span class="comment">// 第三种 通用方式 只需要引用js文件</span></span><br><span class="line">            <span class="attr">data</span>:&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;zhangsan&#x27;</span>&#125;,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> cookieValue = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">cookie</span> &amp;&amp; <span class="variable language_">document</span>.<span class="property">cookie</span> !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> cookies = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cookies.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> cookie = cookies[i].<span class="title function_">trim</span>();</span><br><span class="line">            <span class="comment">// Does this cookie string begin with the name we want?</span></span><br><span class="line">            <span class="keyword">if</span> (cookie.<span class="title function_">substring</span>(<span class="number">0</span>, name.<span class="property">length</span> + <span class="number">1</span>) === (name + <span class="string">&#x27;=&#x27;</span>)) &#123;</span><br><span class="line">                cookieValue = <span class="built_in">decodeURIComponent</span>(cookie.<span class="title function_">substring</span>(name.<span class="property">length</span> + <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cookieValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> csrftoken = <span class="title function_">getCookie</span>(<span class="string">&#x27;csrftoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">csrfSafeMethod</span>(<span class="params">method</span>) &#123;</span><br><span class="line">    <span class="comment">// these HTTP methods do not require CSRF protection</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="regexp">/^(GET|HEAD|OPTIONS|TRACE)$/</span>.<span class="title function_">test</span>(method));</span><br><span class="line">&#125;</span><br><span class="line">$.<span class="title function_">ajaxSetup</span>(&#123;</span><br><span class="line">    <span class="attr">beforeSend</span>: <span class="keyword">function</span>(<span class="params">xhr, settings</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">csrfSafeMethod</span>(settings.<span class="property">type</span>) &amp;&amp; !<span class="variable language_">this</span>.<span class="property">crossDomain</span>) &#123;</span><br><span class="line">            xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;X-CSRFToken&quot;</span>, csrftoken);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="csrf装饰器"><a href="#csrf装饰器" class="headerlink" title="csrf装饰器"></a>csrf装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 网站整体都不校验csrf,就单单几个视图函数需要校验</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 网站整体都校验csrf,就单单几个视图函数不校验</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 当settings中注释掉csrf后,再views函数上面添加</span></span><br><span class="line"><span class="meta">@csrf_protect	校验</span></span><br><span class="line"><span class="comment"># 当settings中开启csrf后,在views函数上面添加</span></span><br><span class="line"><span class="meta">@csrf_exempt	不校验</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对CBV的装饰器三种方式</span></span><br><span class="line">csrf_protect 三种方式都可以</span><br><span class="line">	<span class="comment"># 第一种</span></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">csrf_protect</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 第二种</span></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">csrf_protect,name=<span class="string">&#x27;post&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MyCsrfToken</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 第三种</span></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">csrf_protext</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self,request,*args,**kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(MyCsrfToken,self).dispatch(request,*args,**kwargs)</span><br><span class="line">    </span><br><span class="line">csrf_exempt 只有唯一一种方式可以 那就是上面的第三种方式</span><br><span class="line"><span class="meta">	@method_decorator(<span class="params">csrf_exempt</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self,request,*args,**kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(MyCsrfToken,self).dispatch(request,*args,**kwargs)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a>补充知识点</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模块:importlib</span></span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">res = <span class="string">&#x27;myfile.b&#x27;</span></span><br><span class="line">ret = importlib.import_module(res)  <span class="comment"># from myfile import b</span></span><br><span class="line"><span class="comment"># 该方法最小只能到py文件名</span></span><br><span class="line"><span class="built_in">print</span>(ret)</span><br></pre></td></tr></table></figure>

<h3 id="重要思想"><a href="#重要思想" class="headerlink" title="重要思想"></a>重要思想</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_all</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">for</span> path_str <span class="keyword">in</span> settings.NOTIFY_LIST:  <span class="comment">#&#x27;notify.email.Email&#x27;</span></span><br><span class="line">        module_path,class_name = path_str.rsplit(<span class="string">&#x27;.&#x27;</span>,maxsplit=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># module_path = &#x27;notify.email&#x27;  class_name = &#x27;Email&#x27;</span></span><br><span class="line">        <span class="comment"># 1 利用字符串导入模块</span></span><br><span class="line">        module = importlib.import_module(module_path)  <span class="comment"># from notify import email</span></span><br><span class="line">        <span class="comment"># 2 利用反射获取类名</span></span><br><span class="line">        cls = <span class="built_in">getattr</span>(module,class_name)  <span class="comment"># Email、QQ、Wechat</span></span><br><span class="line">        <span class="comment"># 3 生成类的对象</span></span><br><span class="line">        obj = cls()</span><br><span class="line">        <span class="comment"># 4 利用鸭子类型直接调用send方法</span></span><br><span class="line">        obj.send(content)</span><br></pre></td></tr></table></figure>

<h2 id="Auth模块"><a href="#Auth模块" class="headerlink" title="Auth模块"></a>Auth模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">其实我们在创建好一个django项目之后执行数据库迁移命令会自动生成很多表</span></span><br><span class="line"><span class="string">	django_session</span></span><br><span class="line"><span class="string">	auth_user</span></span><br><span class="line"><span class="string">django在启动之后就可以直接访问admin路由,需要输入用户名和密码,数据参考的就是auth_user表,并且还必须是管理员用户才能进入</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 创建超级用户(管理员)</span></span><br><span class="line">Python3 manage.py createsuperuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖auth_user表完成相关所有功能</span></span><br></pre></td></tr></table></figure>

<h3 id="方法总结"><a href="#方法总结" class="headerlink" title="方法总结"></a>方法总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.比对用户名和密码是否正确</span></span><br><span class="line">user_obj = auth.authenticate(request,username=username,password=password)</span><br><span class="line"><span class="comment"># 括号内必须同时传入用户名和密码</span></span><br><span class="line"><span class="built_in">print</span>(user_obj)  <span class="comment"># 用户对象  jason   数据不符合则返回None</span></span><br><span class="line"><span class="built_in">print</span>(user_obj.username)  <span class="comment"># jason</span></span><br><span class="line"><span class="built_in">print</span>(user_obj.password)  <span class="comment"># 密文</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.保存用户状态</span></span><br><span class="line">auth.login(request,user_obj)  <span class="comment"># 类似于request.session[key] = user_obj</span></span><br><span class="line"><span class="comment"># 主要执行了该方法 你就可以在任何地方通过request.user获取到当前登陆的用户对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.判断当前用户是否登陆</span></span><br><span class="line">request.user.is_authenticated()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.获取当前登陆用户</span></span><br><span class="line">request.user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.校验用户是否登陆装饰器</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="comment"># 局部配置</span></span><br><span class="line"><span class="meta">@login_required(<span class="params">login_url=<span class="string">&#x27;/login/&#x27;</span></span>) </span></span><br><span class="line"><span class="comment"># 全局配置</span></span><br><span class="line">LOGIN_URL = <span class="string">&#x27;/login/&#x27;</span></span><br><span class="line">	<span class="number">1.</span>如果局部和全局都有 该听谁的?</span><br><span class="line">    局部 &gt; 全局</span><br><span class="line">	<span class="number">2.</span>局部和全局哪个好呢?</span><br><span class="line">    全局的好处在于无需重复写代码 但是跳转的页面却很单一</span><br><span class="line">    局部的好处在于不同的视图函数在用户没有登陆的情况下可以跳转到不同的页面</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.比对原密码</span></span><br><span class="line">request.user.check_password(old_password)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.修改密码</span></span><br><span class="line">request.user.set_password(new_password)  <span class="comment"># 仅仅是在修改对象的属性</span></span><br><span class="line">request.user.save()  <span class="comment"># 这一步才是真正的操作数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.注销</span></span><br><span class="line">auth.logout(request) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.注册</span></span><br><span class="line"><span class="comment"># 操作auth_user表写入数据</span></span><br><span class="line">User.objects.create(username=username,password=password)  <span class="comment"># 写入数据  不能用create 密码没有加密处理</span></span><br><span class="line"><span class="comment"># 创建普通用户</span></span><br><span class="line">User.objects.create_user(username=username,password=password)</span><br><span class="line"><span class="comment"># 创建超级用户(了解):使用代码创建超级用户 邮箱是必填的 而用命令创建则可以不填</span></span><br><span class="line">User.objects.create_superuser(username=username,email=<span class="string">&#x27;123@qq.com&#x27;</span>,password=password)</span><br></pre></td></tr></table></figure>

<h3 id="如何扩展auth-user表"><a href="#如何扩展auth-user表" class="headerlink" title="如何扩展auth_user表"></a>如何扩展auth_user表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种 一对一关系表</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDetail</span>(models.Model):</span><br><span class="line">    phone = models.BigIntegerField()</span><br><span class="line">    user = models.OneToOneField(to=<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种 面向对象的继承</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    如果继承了AbstractUser</span></span><br><span class="line"><span class="string">    那么执行数据库迁移的时候auth_user表将不会再被创建出来了</span></span><br><span class="line"><span class="string">    而UserInfo表中会出现auth_user表中的所有字段以及自己扩展的字段</span></span><br><span class="line"><span class="string">    好处: 在于你能够直接点击你自己的表更加快速的完成操作和扩展</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    前提: </span></span><br><span class="line"><span class="string">        1. 在继承之前没有执行数据库迁移命令</span></span><br><span class="line"><span class="string">            auth_user没有被创建,如果当前库已经创建了,就需要重新换一个database</span></span><br><span class="line"><span class="string">        2. 继承的类里面的不要覆盖AbstractUser里面的字段名</span></span><br><span class="line"><span class="string">            表里面有的字段不要动,只扩展外的字段</span></span><br><span class="line"><span class="string">        3. 需要在配置文件中告诉django,你需要使用UserInfo替代auth_user</span></span><br><span class="line"><span class="string">            AUTH_USER_MODEL = &#x27;app01.UserInfo&#x27;</span></span><br><span class="line"><span class="string">                                应用名.表名</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    phone = BigIntegerField()</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    你如果自己写表替代了auth_user那么,auth模块的功能还是照常使用</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
  </article>
  <footer class="f-cf">
    
      <a href="/2021/03/12/04%20Django%20bbs%E5%BC%80%E5%8F%91-04djangobbs%E5%BC%80%E5%8F%91/" class="link f-fl">⟵04 Django bbs开发</a>
    
    
      <a href="/2021/03/05/02%20Django%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-02django%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/" class="link f-fr">02 Django入门到精通⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  reidosann@163.com
  
    
      
        · <a href="https://github.com/evansuner" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">Powered by Evan</span>
</footer>
  </div>
</body>
</html>