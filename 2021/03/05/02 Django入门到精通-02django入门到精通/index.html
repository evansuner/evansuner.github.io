<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>02 Django入门到精通 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="settings.py配置文件     — urls路由     — wsgi.py wsgiref模块 不考虑  – manage.py Django入口文件  – db.sqlite3 Django自带的小型数据库  – app01文件夹     — admin.py Django后台管理     — migrations文件夹 数据库前已记录     — models.py 数据库相关的模">
<meta property="og:type" content="article">
<meta property="og:title" content="02 Django入门到精通">
<meta property="og:url" content="http://example.com/2021/03/05/02%20Django%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-02django%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="settings.py配置文件     — urls路由     — wsgi.py wsgiref模块 不考虑  – manage.py Django入口文件  – db.sqlite3 Django自带的小型数据库  – app01文件夹     — admin.py Django后台管理     — migrations文件夹 数据库前已记录     — models.py 数据库相关的模">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-03-04T19:17:11.000Z">
<meta property="article:modified_time" content="2021-11-08T19:54:54.096Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="django">
<meta name="twitter:card" content="summary">
  
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
  <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block);
      });
    });
  </script>
  
<link rel="stylesheet" href="/css/index.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">02 Django入门到精通</h2>
  <p class="sub">Mar 5, 2021</p>
  <article class="content">
    <p> settings.py配置文件<br>     — urls路由<br>     — wsgi.py wsgiref模块 不考虑<br>  – manage.py Django入口文件<br>  – db.sqlite3 Django自带的小型数据库<br>  – app01文件夹<br>     — admin.py Django后台管理<br>     — migrations文件夹 数据库前已记录<br>     — models.py 数据库相关的模型 模型类(orm)<br>     — test.py测试文件<br>     — views.py 视图函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## Django三板斧</span><br><span class="line"></span><br><span class="line">+ render</span><br><span class="line">+ HttpResponse</span><br><span class="line">+ redirect</span><br><span class="line"></span><br><span class="line"># 静态文件配置</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">默认情况下 </span><br><span class="line">我们将HTML文件放在 template文件夹下</span><br><span class="line">将网站所使用的的静态文件默认存放在static文件夹下</span><br><span class="line"></span><br><span class="line">静态文件:</span><br><span class="line">    前端写好了的	能够直接调用使用的文件</span><br><span class="line">    前端写好的js文件</span><br><span class="line">    网站写好的css文件</span><br><span class="line">    网站用到的图片文件</span><br><span class="line">    第三方前端框架</span><br><span class="line"></span><br><span class="line">Django默认情况下是不会自动创建static文件夹	需要自己创建</span><br><span class="line">在浏览器中输入url能够看到对应的资源</span><br><span class="line">是因为后端提前开设了该资源的接口</span><br><span class="line">如果访问不到资源 说明后端没有开设该资源的接口</span><br><span class="line"></span><br><span class="line">STATIC_URL = &#x27;/static/&#x27; # 类似于访问静态文件的令牌</span><br><span class="line">&quot;&quot;&quot;如果你想要访问静态文件,你就必须以static开头&quot;&quot;&quot;</span><br><span class="line"># 静态文件配置</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR,&#x27;static&#x27;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 静态文件动态解析 使用模板语法</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;% static &#x27;bootstrap-...css&#x27; %&#125;&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;&#123;% static &#x27;bootstrap-...js&#x27; %&#125;&quot;&gt;&lt;/script&gt;</span><br><span class="line">    </span><br><span class="line"># form表单默认是get请求</span><br><span class="line">https://127.0.0.1:8000/login/?username=zhangsan&amp;password=124</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">form表单action参数</span><br><span class="line">1. 不写 默认朝当前所在的url提交数据</span><br><span class="line">2. 全写 指名道姓</span><br><span class="line">3. 只写后缀 /login/</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 前期我们使用Django提交post请求 需要在middleware中注释掉一行代码</span><br><span class="line"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br></pre></td></tr></table></figure>

<h1 id="request对象方法"><a href="#request对象方法" class="headerlink" title="request对象方法"></a>request对象方法</h1><ul>
<li>request.method</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 返回一个登陆界面</span></span><br><span class="line">    <span class="comment"># print(request.method) # 返回请求方式 全大写的字符串形式</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登陆成功&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get 方式&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>request.POST</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">request.POST.getlist(<span class="string">&#x27;hobby&#x27;</span>)</span><br><span class="line"><span class="comment"># get()只能获得列表中的最后一个元素</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>request.GET</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">request.POST.getlist(<span class="string">&#x27;hobby&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="Django链接mysql"><a href="#Django链接mysql" class="headerlink" title="Django链接mysql"></a>Django链接mysql</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一步</span></span><br><span class="line"><span class="comment"># &#x27;ENGINE&#x27;: &#x27;django.db.backends.sqlite3&#x27;,</span></span><br><span class="line"><span class="comment"># &#x27;NAME&#x27;: os.path.join(BASE_DIR, &#x27;db.sqlite3&#x27;),</span></span><br><span class="line"><span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;day59&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;PORT&#x27;</span>:<span class="number">3306</span>,</span><br><span class="line"><span class="string">&#x27;CHARSET&#x27;</span>:<span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步</span></span><br><span class="line">Django默认使用mysqldb模块链接MySQL</span><br><span class="line">但是该模块兼容性不好 需要改用pymysql链接</span><br><span class="line"></span><br><span class="line">需要告诉Django不要使用默认的mysqldb而是使用pymysql</span><br><span class="line"><span class="comment">## 在项目名下的init或者任意的应用名下的init文件中书写以下代码</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h1 id="Django-ORM"><a href="#Django-ORM" class="headerlink" title="Django ORM"></a>Django ORM</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">orm 对象关系映射</span><br><span class="line">类					 表</span><br><span class="line">对象					记录</span><br><span class="line">对象属性			   记录某个字段对应的值</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemigrations</span><br><span class="line">python3 manage.py migrate</span><br><span class="line">只要修改了models.py中的属性,就必须重新输入以上两条命令</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(models.Model):</span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>,verbose_name=<span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">256</span>,verbose_name=<span class="string">&#x27;密码&#x27;</span>)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    CharField 必须要指定max_length参数,否则直接报错</span></span><br><span class="line"><span class="string">    verbose_name 是每一个字段都有的 是对这个字段的解释</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>(models.Model):</span><br><span class="line">    <span class="comment"># 由于一张表中必须要有一个主键字段 并且一般情况下都叫做id字段</span></span><br><span class="line">    <span class="comment"># 所以orm当你不定义主键字段的时候 orm会自动创建一个名为id的主键字段</span></span><br><span class="line">    <span class="comment"># 也就意味着 后续我们在创建模型表的时候如果主键没有特殊的叫法,可以不自己创建</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">256</span>)</span><br></pre></td></tr></table></figure>

<h1 id="字段的增删改查"><a href="#字段的增删改查" class="headerlink" title="字段的增删改查"></a>字段的增删改查</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字段的增加</span></span><br><span class="line">	<span class="number">1.</span> 可以再终端中给出默认值</span><br><span class="line">    	age = models.IntegerField(verbose_name=<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">    <span class="number">2.</span> 该字段可以为空</span><br><span class="line">    	info = models.CharField(max_length=<span class="number">128</span>,null=<span class="literal">True</span>)</span><br><span class="line">    <span class="number">3.</span> 直接给该字段设置默认值</span><br><span class="line">    	hobby = models.CharField(max_length=<span class="number">128</span>,default=<span class="string">&#x27;study&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 字段的修改</span></span><br><span class="line">	直接修改代码然后执行数据库迁移的两条命令</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字段的删除(不要轻易地操作)</span></span><br><span class="line">	对应字段注释,然后执行数据库迁移的两条命令</span><br><span class="line">    执行完毕之后字段对应的数据也就没有了</span><br></pre></td></tr></table></figure>

<h1 id="数据的增删改查"><a href="#数据的增删改查" class="headerlink" title="数据的增删改查"></a>数据的增删改查</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查</span></span><br><span class="line">res = models.User.objects.<span class="built_in">filter</span>(username=username)</span><br><span class="line">user_obj = res[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">user_obj = models.User.objects.<span class="built_in">filter</span>(username=username).first()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">返回值可以看成列表套数据对象的格式</span></span><br><span class="line"><span class="string">它也支持索引取值</span></span><br><span class="line"><span class="string">filter内可以携带多个参数 参数之间使用and关系</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line"><span class="comment">## 第一种方式:</span></span><br><span class="line">res = models.User.objects.create(username=username,password=password)    </span><br><span class="line">返回值就是被创建对象的本身</span><br><span class="line"><span class="comment">## 第二种方式</span></span><br><span class="line">user_obj = models.User()</span><br><span class="line">user_obj.username = username</span><br><span class="line">user_obj.password = password</span><br><span class="line">user_obj.save()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据的查改删</span></span><br><span class="line"><span class="comment"># 编辑功能</span></span><br><span class="line">	点击编辑按钮 朝后端发送编辑数据的请求</span><br><span class="line">   		如何告诉后端用户想要编辑的那一条数据?</span><br><span class="line">        将编辑按钮所在哪一行的数据的主键值发送给后端</span><br><span class="line">        利用url带问号携带参数的方式</span><br><span class="line">    后端查询出用户想要编辑的数据对象 展示到前端页面提供给用户查看和编辑</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"><span class="comment"># 删除功能</span></span><br><span class="line">	删除数据内部并不是真正的删除</span><br><span class="line">    我们会给数据添加一个表示字段,用来表示当前字段是否被删除</span><br><span class="line">    如果数据被删除了仅仅只是将字段修改了一个状态</span><br><span class="line">    username	password    is_delete</span><br><span class="line">    张三			<span class="number">123</span>			<span class="number">0</span></span><br><span class="line">    李四			<span class="number">123</span>			<span class="number">1</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h1 id="Django-orm创建表"><a href="#Django-orm创建表" class="headerlink" title="Django orm创建表"></a>Django orm创建表</h1><p>Django1.x 版本中外键默认都是级联删除更新的</p>
<h1 id="Django请求生命周期流程图"><a href="#Django请求生命周期流程图" class="headerlink" title="Django请求生命周期流程图"></a>Django请求生命周期流程图</h1><p>![image-20210616155614748](C:\Users\evans\Documents\Typora\web-backend-learning\02 Django入门到精通.assets\image-20210616155614748.png)</p>
<h1 id="路由层"><a href="#路由层" class="headerlink" title="路由层"></a>路由层</h1><h2 id="路由匹配"><a href="#路由匹配" class="headerlink" title="路由匹配"></a>路由匹配</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;test&#x27;</span>,views.test),</span><br><span class="line">    url(<span class="string">r&#x27;testadd&#x27;</span>,views.testadd)</span><br><span class="line">]</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;test/&#x27;</span>,views.test),</span><br><span class="line">    url(<span class="string">r&#x27;testadd/&#x27;</span>,views.testadd)</span><br><span class="line">]</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^test/$&#x27;</span>,views.test),</span><br><span class="line">    url(<span class="string">r&#x27;^testadd/$&#x27;</span>,views.testadd)</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 首页</span></span><br><span class="line">url(<span class="string">r&#x27;^$&#x27;</span>,views.index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Django自动添加 /</span></span><br><span class="line">APPEND_SLASH = <span class="literal">True</span>/<span class="literal">False</span> <span class="comment"># 默认True</span></span><br></pre></td></tr></table></figure>

<h2 id="无名分组"><a href="#无名分组" class="headerlink" title="无名分组"></a>无名分组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;分组就是将某一段正则表达式 用小括号括起来&quot;&quot;&quot;</span></span><br><span class="line">url(<span class="string">r&#x27;^test/(\d+)/&#x27;</span>,views.test),</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">request,xxx</span>):</span><br><span class="line">    <span class="built_in">print</span>(xxx)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"><span class="comment"># 无名分组就是将括号里正则表达式匹配到的内容作为位置参数 传递给对应的视图函数</span></span><br></pre></td></tr></table></figure>

<h2 id="有名分组"><a href="#有名分组" class="headerlink" title="有名分组"></a>有名分组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;可以给正则表达式起一个别名&quot;&quot;&quot;</span></span><br><span class="line">url(<span class="string">r&#x27;^testadd/(?P&lt;year&gt;\d+)/&#x27;</span>,views.test),</span><br><span class="line"></span><br><span class="line"><span class="comment"># ?P&lt;year&gt; 指代的就是需要传入的关键字参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testadd</span>(<span class="params">request,year</span>):</span><br><span class="line">    <span class="built_in">print</span>(year)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;testadd&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有名分组就是将括号里正则表达式匹配到的内容作为关键字参数 传递给对应的视图函数</span></span><br></pre></td></tr></table></figure>

<h2 id="无名和有名是否可以混合使用"><a href="#无名和有名是否可以混合使用" class="headerlink" title="无名和有名是否可以混合使用"></a>无名和有名是否可以混合使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;index/(\d+)/(?P&lt;year&gt;\d+)&#x27;</span>,views.index) <span class="comment"># 这是错误写法,两者不能混用</span></span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;index/(\d+)/(\d+)/(\d+)&#x27;</span>,views.index)</span><br><span class="line">url(<span class="string">r&#x27;index/(?P&lt;year&gt;\d+)/?P&lt;month&gt;(\d+)/(?P&lt;day&gt;\d+)&#x27;</span>,views.index)</span><br></pre></td></tr></table></figure>

<h2 id="反响解析"><a href="#反响解析" class="headerlink" title="反响解析"></a>反响解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过一些方法得到一个结果 该结果可以直接访问对应的url出发视图函数</span></span><br><span class="line"><span class="comment"># 先给路由与视图起一个别名</span></span><br><span class="line">url(<span class="string">r&#x27;^func/&#x27;</span>,views.func,name=<span class="string">&#x27;ooo&#x27;</span>)</span><br><span class="line"><span class="comment"># 反向解析</span></span><br><span class="line">	<span class="comment"># 后端反响解析</span></span><br><span class="line">    <span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> reverse</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">request</span>):</span><br><span class="line">        <span class="built_in">print</span>(reverse(<span class="string">&#x27;ooo&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> render()</span><br><span class="line">    <span class="comment"># 前段反响解析</span></span><br><span class="line">    &lt;a href=<span class="string">&quot;&#123;% url &#x27;ooo&#x27; %&#125;&quot;</span>&gt;xxx&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h2 id="无名有名分组反向解析"><a href="#无名有名分组反向解析" class="headerlink" title="无名有名分组反向解析"></a>无名有名分组反向解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无名分组反向解析</span></span><br><span class="line">url(<span class="string">r&#x27;index/(\d+)&#x27;</span>,views.index,name=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前端</span></span><br><span class="line">&#123;% url <span class="string">&#x27;index&#x27;</span> <span class="number">123</span> %&#125;</span><br><span class="line"><span class="comment"># 后端</span></span><br><span class="line">reverse(<span class="string">&#x27;index&#x27;</span>,args=(<span class="number">123</span>,))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这个数字写代码的时候应该放什么</span></span><br><span class="line"><span class="string">	数字一般情况下放的是数据的主键值 数据的编辑和删除</span></span><br><span class="line"><span class="string">	url(r&#x27;^edit/(\d+)/&#x27;,views.edit,name=&#x27;edit&#x27;)</span></span><br><span class="line"><span class="string">	def edit(request,edit_id):</span></span><br><span class="line"><span class="string">		reverse(&#x27;edit&#x27;,args=(edit_id,))</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &#123;% for user in user_queryset %&#125;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;&#123;&#123; url &#x27;edit&#x27; user.id &#125;&#125;&quot;&gt;编辑&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#123;% endfor %&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">作业: 利用无名有名 完成数据的增删改查</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 有名分组的反向解析</span></span><br><span class="line">url(<span class="string">r&#x27;^func/(?P&lt;year&gt;\d+)&#x27;</span>,views.func,name=<span class="string">&#x27;func&#x27;</span>)</span><br><span class="line"><span class="comment"># 后端</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 写法一:</span></span><br><span class="line">    <span class="built_in">print</span>(reverse(<span class="string">&#x27;func&#x27;</span>,kwargs=&#123;<span class="string">&#x27;year&#x27;</span>:<span class="number">123</span>&#125;))</span><br><span class="line">    <span class="comment"># 写法二:</span></span><br><span class="line">    <span class="built_in">print</span>(reverse(<span class="string">&#x27;func&#x27;</span>,args=(<span class="number">123</span>,)))</span><br><span class="line"><span class="comment"># 前端</span></span><br><span class="line">	<span class="comment"># 第二种写法:</span></span><br><span class="line">	&#123;% url <span class="string">&#x27;index&#x27;</span> <span class="number">123</span> %&#125;</span><br><span class="line">    <span class="comment"># 第一种</span></span><br><span class="line">    &#123;% url <span class="string">&#x27;index&#x27;</span> year=<span class="number">123</span> %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a>路由分发</h2><p>每一个应用都可以有自己的templates, urls.py, static</p>
<p>正是基于上述的特点 Django能够非常好的做到分组开发(每个人只写自己的app)</p>
<p>作为组长 只需要将组员写的app全部拷贝到一个新的Django项目中,然后在配置文件里注册所有的app,再利用路由分发的特点,将所有的app整合到一起</p>
<p>当一个项目中的url特别多的时候	总路由urls.py代码非常冗余不好维护,这时候也可以利用路由分发来减轻总路由的压力</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 总路由</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> urls <span class="keyword">as</span> app01_urls</span><br><span class="line"><span class="keyword">from</span> app02 <span class="keyword">import</span> urls <span class="keyword">as</span> app02_urls</span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(app01_urls)), <span class="comment"># 只要url前缀是app01开头的,全部交给app01处理</span></span><br><span class="line">url(<span class="string">r&#x27;^app02/&#x27;</span>,include(app02_urls))</span><br><span class="line"><span class="comment"># 终极写法(推荐使用)</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>))</span><br><span class="line">url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 子路由</span></span><br><span class="line"><span class="comment"># app01</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^reg/&#x27;</span>,views.reg),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># app02</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^reg/&#x27;</span>,views.reg),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="名称空间-了解"><a href="#名称空间-了解" class="headerlink" title="名称空间(了解)"></a>名称空间(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当多个应用出现了相同的别名 我们研究反向解析会不会自动识别应用前缀</span></span><br><span class="line"></span><br><span class="line">正常情况下反向解析是没有办法自动识别前缀的</span><br><span class="line"></span><br><span class="line">这时候我们就需要应用名称空间的概念</span><br><span class="line">在主路由中设置:</span><br><span class="line">    url(<span class="string">r&#x27;^app01/&#x27;</span>,include(<span class="string">&#x27;app01.urls&#x27;</span>,namespace=<span class="string">&#x27;app01&#x27;</span>)),</span><br><span class="line">    url(<span class="string">r&#x27;^app02/&#x27;</span>,include(<span class="string">&#x27;app02.urls&#x27;</span>,namespace=<span class="string">&#x27;app02&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    reverse(<span class="string">&#x27;app01:reg&#x27;</span>)</span><br><span class="line">    reverse(<span class="string">&#x27;app02:reg&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    &#123;% url <span class="string">&#x27;app01:reg&#x27;</span> %&#125;</span><br><span class="line">    &#123;% url <span class="string">&#x27;app02:reg&#x27;</span> %&#125;</span><br><span class="line">    </span><br><span class="line">其实只要保证名字不冲突 就没有必要使用名称空间</span><br><span class="line">一百年情况下 有多个app的时候我们在起别名的时候会加上app的前缀,这样就可以确保多个app直接名字不会冲突</span><br><span class="line"></span><br><span class="line">url(<span class="string">r&#x27;^reg/&#x27;</span>,views.reg,name=<span class="string">&#x27;app01_reg&#x27;</span>),</span><br><span class="line">url(<span class="string">r&#x27;^reg/&#x27;</span>,views.reg,name=<span class="string">&#x27;app02_reg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="伪静态-了解"><a href="#伪静态-了解" class="headerlink" title="伪静态(了解)"></a>伪静态(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">将一个动态网页 伪装成静态网页</span></span><br><span class="line"><span class="string">目的: 在于增大本网站的seo查询力度 并且增加搜索引擎收录本网的概率</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">搜索引擎本质上就是一个巨大的搜索引擎</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="虚拟环境-了解"><a href="#虚拟环境-了解" class="headerlink" title="虚拟环境(了解)"></a>虚拟环境(了解)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">在正常的开发中 我们会给每一个项目配备一个该项目独有的解释器环境</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Django版本区别"><a href="#Django版本区别" class="headerlink" title="Django版本区别"></a>Django版本区别</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Django <span class="number">1.</span>x路由层使用的是 url</span><br><span class="line">Django <span class="number">2.</span>x/<span class="number">3.</span>x中路由层使用的是path</span><br><span class="line">url() 第一个参数支持正则</span><br><span class="line">path() 第一个参数不支持正则 写什么就标准匹配什么</span><br><span class="line"></span><br><span class="line">如果习惯使用正则, 也提供了另外一个方法 re_path</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path</span><br><span class="line">re_path(<span class="string">r&#x27;^index/&#x27;</span>,views.index)</span><br><span class="line">当然也可以自己导入url,然后使用url,但是在<span class="number">2.</span>x和<span class="number">3.</span>x版本中不提倡</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line">url(<span class="string">r&#x27;^index/&#x27;</span>,views.index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> path支持五种转换器</span><br><span class="line">path(<span class="string">&#x27;index/&lt;int:id&gt;/&#x27;</span>,views.index)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request,<span class="built_in">id</span></span>)</span><br><span class="line">path(<span class="string">&#x27;index/&lt;str:string&gt;/&#x27;</span>)</span><br><span class="line">path(<span class="string">&#x27;index/&lt;slug:other&gt;/&#x27;</span>)	<span class="comment"># 匹配字母,数字,下划线组成的字符串</span></span><br><span class="line">path(<span class="string">&#x27;index/&lt;uuid:uuid&gt;/&#x27;</span>) <span class="comment"># 匹配格式化的UUID</span></span><br><span class="line">path(<span class="string">&#x27;index/&lt;path:path&gt;/&#x27;</span>) <span class="comment"># 匹配任何非空字符串,包含了路径分隔符(/) 不能使用?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> path还支持自定义转换器(了解)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonthConverter</span>:</span><br><span class="line">    regex=<span class="string">&#x27;\d&#123;2&#125;&#x27;</span></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">to_python</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(value)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_url</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="keyword">return</span> value <span class="comment"># 匹配的regex是两个数字,饭后的结果也必须是两个数字</span></span><br><span class="line"><span class="comment"># 注册转换器</span></span><br><span class="line"><span class="keyword">from</span> register_converter(MonthConverter,<span class="string">&#x27;mon&#x27;</span>)</span><br><span class="line">path(<span class="string">&#x27;index/&lt;mon:mon&gt;/&#x27;</span>,views.index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> <span class="number">1.</span>x 模型层里的外键默认都是级联删除的</span><br><span class="line">但是到了<span class="number">2.</span>x和<span class="number">3.</span>x中需要自己手动设置参数</span><br><span class="line">models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>)</span><br><span class="line">models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>,on_delete=models.CASCADE...)</span><br></pre></td></tr></table></figure>

<h1 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h1><h2 id="三板斧"><a href="#三板斧" class="headerlink" title="三板斧"></a>三板斧</h2><ul>
<li><p>HttpResponse</p>
<p>返回字符串类型</p>
</li>
<li><p>render</p>
<p>返回HTML页面 并且在返回浏览器之前还可以个给HTML传值</p>
</li>
<li><p>redirect</p>
<p>重定向</p>
</li>
</ul>
<h2 id="JsonResponse对象"><a href="#JsonResponse对象" class="headerlink" title="JsonResponse对象"></a>JsonResponse对象</h2><h2 id="form表单上传文件及后端如何获取"><a href="#form表单上传文件及后端如何获取" class="headerlink" title="form表单上传文件及后端如何获取"></a>form表单上传文件及后端如何获取</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">form表单上传文件类型的数据</span></span><br><span class="line"><span class="string">1. method必须指定为post</span></span><br><span class="line"><span class="string">2. enctype必须指定为fordata</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ab_file</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># print(request.POST.get()) # POST无法获取到文件</span></span><br><span class="line">        <span class="comment"># print(request.FILES)</span></span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&#x27;file&#x27;</span>)  <span class="comment"># 文件对象</span></span><br><span class="line">        <span class="built_in">print</span>(file_obj.name) <span class="comment"># 文件名</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_obj.name,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                <span class="comment"># 官方推荐添加上chunks方法 其实不添加也一样,都是一行一行的读取</span></span><br><span class="line">                f.write(line)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;form.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="request对象方法-1"><a href="#request对象方法-1" class="headerlink" title="request对象方法"></a>request对象方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request.method()</span><br><span class="line">request.POST()</span><br><span class="line">request.GET()</span><br><span class="line">request.FILES()</span><br><span class="line">request.path <span class="comment"># 只能拿到参数</span></span><br><span class="line">request.path_info</span><br><span class="line">request.get_full_path() <span class="comment"># 不仅能够拿到路径还可以拿到?后面的参数</span></span><br><span class="line">request.body <span class="comment"># 原生的浏览器发过来的二进制数据</span></span><br></pre></td></tr></table></figure>

<h2 id="FBV与CBV"><a href="#FBV与CBV" class="headerlink" title="FBV与CBV"></a>FBV与CBV</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FBV</span></span><br><span class="line"><span class="comment"># 视图函数既可以是函数也可以是类</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CBV</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLogin</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;form.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;post方法&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">url(<span class="string">r&#x27;^login&#x27;</span>,views.MyLogin.as_view()),</span><br><span class="line"></span><br><span class="line"><span class="comment"># FBV和CBV各有千秋</span></span><br><span class="line">CBV特点:</span><br><span class="line">    能够根据请求方式的不同直接匹配到对应的方法执行</span><br></pre></td></tr></table></figure>

<h2 id="CBV源码-重点"><a href="#CBV源码-重点" class="headerlink" title="CBV源码(重点)"></a>CBV源码(重点)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 突破口在urls.py</span></span><br><span class="line">url(<span class="string">r&#x27;^login/&#x27;</span>,views.MyLogin.as_view())</span><br><span class="line"><span class="comment"># url(r&#x27;^login/&#x27;,views.view)  FBV一模一样</span></span><br><span class="line"><span class="comment"># CBV与FBV在路由匹配上本质是一样的 都是路由 对应 函数内存地址</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">函数名/方法名 加括号执行优先级最高</span></span><br><span class="line"><span class="string">猜测</span></span><br><span class="line"><span class="string">    as_view()</span></span><br><span class="line"><span class="string">        要么是被@staicmethod修饰的静态方法</span></span><br><span class="line"><span class="string">        要么是被@classmethod修饰的类方法  正确</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    @classonlymethod</span></span><br><span class="line"><span class="string">    def as_view(cls, **initkwargs):</span></span><br><span class="line"><span class="string">        pass</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classonlymethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls, **initkwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        cls就是我们自己写的类   MyCBV</span></span><br><span class="line"><span class="string">        Main entry point for a request-response process.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">            self = cls(**initkwargs)  <span class="comment"># cls是我们自己写的类</span></span><br><span class="line">            <span class="comment"># self = MyLogin(**initkwargs)  产生一个我们自己写的类的对象</span></span><br><span class="line">            <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            以后你们会经常需要看源码 但是在看python源码的时候 一定要时刻提醒自己面向对象属性方法查找顺序</span></span><br><span class="line"><span class="string">                先从对象自己找</span></span><br><span class="line"><span class="string">                再去产生对象的类里面找</span></span><br><span class="line"><span class="string">                之后再去父类找</span></span><br><span class="line"><span class="string">                ...</span></span><br><span class="line"><span class="string">            总结:看源码只要看到了self点一个东西 一定要问你自己当前这个self到底是谁</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">      </span><br><span class="line">		<span class="comment"># CBV的精髓</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 获取当前请求的小写格式 然后比对当前请求方式是否合法</span></span><br><span class="line">        <span class="comment"># get请求为例</span></span><br><span class="line">        <span class="comment"># post请求</span></span><br><span class="line">        <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> self.http_method_names:</span><br><span class="line">            handler = <span class="built_in">getattr</span>(self, request.method.lower(), self.http_method_not_allowed)</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            反射:通过字符串来操作对象的属性或者方法</span></span><br><span class="line"><span class="string">                handler = getattr(自己写的类产生的对象,&#x27;get&#x27;,当找不到get属性或者方法的时候就会用第三个参数)</span></span><br><span class="line"><span class="string">                handler = 我们自己写的类里面的get方法</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            handler = self.http_method_not_allowed</span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        自动调用get方法</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要求掌握到不看源码也能够描述出CBV的内部执行流程(******)</span></span><br></pre></td></tr></table></figure>

<h2 id="模板的继承"><a href="#模板的继承" class="headerlink" title="模板的继承"></a>模板的继承</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模板的继承 需要提前序号一个想要继承的模板页面</span></span><br><span class="line">&#123;% extends <span class="string">&#x27;base.html&#x27;</span> %&#125;</span><br><span class="line">之后埋坑+填坑</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般情况下我们需要在一个模板中至少埋三个坑</span></span><br><span class="line">block js</span><br><span class="line">block css</span><br><span class="line">block content</span><br></pre></td></tr></table></figure>

<h2 id="模板的导入"><a href="#模板的导入" class="headerlink" title="模板的导入"></a>模板的导入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将页面的某一个局部当成模块的形式 那个地方需要就可以直接导入使用即可</span></span><br><span class="line">&#123;% include <span class="string">&#x27;module.html&#x27;</span> %&#125;</span><br></pre></td></tr></table></figure>

<h1 id="模型层"><a href="#模型层" class="headerlink" title="模型层"></a>模型层</h1><h2 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">当你只是想要测试Django中的某一个py文件内容 那么你可以不用书写前后端交互的形式,而是直接写一个测试脚本即可</span></span><br><span class="line"><span class="string">脚本代码无论是写在应用下的test文件中,还是自己单独开设py文件都可以</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 测试环境的准备</span></span><br><span class="line">	<span class="comment"># 去manage.py中拷贝前四行代码 然后自己再写两行</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day05.settings&quot;</span>)</span><br><span class="line"><span class="comment"># Create your tests here.</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">	<span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    <span class="comment"># 所有的脚本文件都要放在配置文件的下面,否则会运行失败</span></span><br><span class="line"></span><br><span class="line">    models.User.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="comment"># 然后在这个代码块的下面就可以编写自己的测试环境</span></span><br></pre></td></tr></table></figure>

<h2 id="查看内部sql语句的方式"><a href="#查看内部sql语句的方式" class="headerlink" title="查看内部sql语句的方式"></a>查看内部sql语句的方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1 queryset对象才能够使用query属性查看内部sql语句</span></span><br><span class="line">res = models.User.objects.values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res.query) <span class="comment"># SELECT `app01_user`.`id`, `app01_user`.`name`, `app01_user`.`age`, `app01_user`.`register_time` FROM `app01_user` WHERE `app01_user`.`id` = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2 所有的sql语句都可以查看</span></span><br><span class="line">需要在配置文件中的任意位置添加</span><br><span class="line"></span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="表单操作"><a href="#表单操作" class="headerlink" title="表单操作"></a>表单操作</h2><h3 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增</span></span><br><span class="line">    <span class="comment"># models.User.objects.create(name=&#x27;zhangsan&#x27;, age=18, register_time=datetime.now())</span></span><br><span class="line">    <span class="comment"># user = models.User()</span></span><br><span class="line">    <span class="comment"># user.name = &#x27;lisi&#x27;</span></span><br><span class="line">    <span class="comment"># user.age = 19</span></span><br><span class="line">    <span class="comment"># user.register_time = datetime.now()</span></span><br><span class="line">    <span class="comment"># user.save()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    <span class="comment"># models.User.objects.filter(pk=2).delete()</span></span><br><span class="line">    <span class="comment"># user = models.User.objects.filter(pk=1)</span></span><br><span class="line">    <span class="comment"># user.delete()</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    pk会自动查找到当前表的主键字段 指代的就是当前表的逐渐字段</span></span><br><span class="line"><span class="string">    用了pk之后你就不需要指代当前表的主键字段到底叫什么了</span></span><br><span class="line"><span class="string">    uid</span></span><br><span class="line"><span class="string">    pid</span></span><br><span class="line"><span class="string">    sid</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    <span class="comment"># models.User.objects.filter(pk=4).update(name=&#x27;liskdsb&#x27;)</span></span><br><span class="line">    <span class="comment"># user = models.User.objects.get(pk=4)</span></span><br><span class="line">    <span class="comment"># user.name = &#x27;wangwu&#x27;</span></span><br><span class="line">    <span class="comment"># user.save()</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get方法返回的直接就是当前的数据对象</span></span><br><span class="line"><span class="string">    但是这个方法不推荐使用</span></span><br><span class="line"><span class="string">    因为一旦数据不存在代码就会直接报错</span></span><br><span class="line"><span class="string">    而filter当数据不存在的时候会返回一个空的queryset</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="必知必会13条"><a href="#必知必会13条" class="headerlink" title="必知必会13条"></a>必知必会13条</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   1. all()    查询全部结果</span></span><br><span class="line"><span class="string">   2. filter() 带过滤条件</span></span><br><span class="line"><span class="string">   3. get()    直接指定结果</span></span><br><span class="line"><span class="string">   4. first()  查询结果第一条</span></span><br><span class="line"><span class="string">   5. last()   查询结果最后一条</span></span><br><span class="line"><span class="string">   6. values() 可以指定获取的数据字段 select name,age from ...  列表套字典</span></span><br><span class="line"><span class="string">   models.User.objects.values(&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"><span class="string">   &lt;QuerySet [&#123;&#x27;zhangsan&#x27;,18&#125;,&#123;&#x27;wangwu&#x27;,19&#125;]&gt;</span></span><br><span class="line"><span class="string">   7. values_list() 可以指定获取的数据字段   列表套元组</span></span><br><span class="line"><span class="string">   models.User.objects.values(&#x27;name&#x27;,&#x27;age&#x27;)</span></span><br><span class="line"><span class="string">   &lt;QuerySet [(&#x27;zhangsan&#x27;,18),(&#x27;wangwu&#x27;,19)]&gt;</span></span><br><span class="line"><span class="string">   8. distinct()   去重</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   9. order_by()   默认升序 添加&quot;-&quot;变成降序</span></span><br><span class="line"><span class="string">   10. reverse()   反转的前提是已经经过排序</span></span><br><span class="line"><span class="string">   models.User.objects.order_by().reverse()</span></span><br><span class="line"><span class="string">   11. count()     统计个数</span></span><br><span class="line"><span class="string">   models.User.objects.count()</span></span><br><span class="line"><span class="string">   12. exclude()   排除..在外</span></span><br><span class="line"><span class="string">   13. exist()     判断..是否存在(几乎用不到) 因为数据本身自带bool属性</span></span><br><span class="line"><span class="string">   models.User.objects.filter(pk=10).exists()</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="双下划线的使用"><a href="#双下划线的使用" class="headerlink" title="双下划线的使用"></a>双下划线的使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大于等于 小于等于</span></span><br><span class="line">age__lge	age__lte</span><br><span class="line"><span class="comment"># 大于 小鱼</span></span><br><span class="line">age__lg		age__lt</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">age__in=[<span class="number">18</span>,<span class="number">19</span>,<span class="number">17</span>]</span><br><span class="line"><span class="comment"># 在某个区段</span></span><br><span class="line">age__range=[<span class="number">18</span>,<span class="number">40</span>]</span><br><span class="line"><span class="comment"># 模糊查询</span></span><br><span class="line">name__contains=<span class="string">&#x27;n&#x27;</span></span><br><span class="line"><span class="comment"># 是否区分大小写</span></span><br><span class="line">默认是区分大小写的</span><br><span class="line">想要忽略大小写</span><br><span class="line">name__icontains=<span class="string">&#x27;n&#x27;</span></span><br><span class="line"><span class="comment"># 以..开头</span></span><br><span class="line">name__startwith=<span class="string">&#x27;n&#x27;</span></span><br><span class="line"><span class="comment"># 以..结尾</span></span><br><span class="line">name__endwith=<span class="string">&#x27;n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询注册时间2021 6月</span></span><br><span class="line">models.User.objects.<span class="built_in">filter</span>(register_time__month=<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">models.User.objects.<span class="built_in">filter</span>(register_time__year=<span class="string">&#x27;2021&#x27;</span>)</span><br><span class="line">models.User.objects.<span class="built_in">filter</span>(register_time__day=<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">models.User.objects.<span class="built_in">filter</span>(register_time__weekday=<span class="string">&#x27;6&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="多表操作"><a href="#多表操作" class="headerlink" title="多表操作"></a>多表操作</h2><h3 id="一对多的外键等删改查"><a href="#一对多的外键等删改查" class="headerlink" title="一对多的外键等删改查"></a>一对多的外键等删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一对多外键增删改查</span></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">    <span class="comment"># 1. 直接写实际字段 id</span></span><br><span class="line">    models.Book.objects.create(title=<span class="string">&#x27;西游记&#x27;</span>, price=<span class="number">123.12</span>, publish_id=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 2. 虚拟字段 对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(pk=2)</span></span><br><span class="line">    <span class="comment"># models.Book.objects.create(title=&#x27;三国演义&#x27;, price=123.12, publish_id=publish_obj)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    <span class="comment"># models.Publish.objects.filter(pk=1).delete() # 级联删除</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    <span class="comment"># models.Book.objects.filter(pk=1).update(publish_id=2)</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(pk=2)</span></span><br><span class="line">    <span class="comment"># models.Book.objects.filter(pk=1).update(publish_id=publish_obj)</span></span><br></pre></td></tr></table></figure>

<h3 id="多对多的外键增删改查"><a href="#多对多的外键增删改查" class="headerlink" title="多对多的外键增删改查"></a>多对多的外键增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多对多的增删改查  实际就是第三张关系表的增删改查</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 如何给书籍添加作者呢? add</span></span><br><span class="line">   <span class="comment"># book_obj = models.Book.objects.filter(pk=1).first()</span></span><br><span class="line">   <span class="comment"># print(book_obj.authors)  # 就类似于你已经到了第三张表了</span></span><br><span class="line">   <span class="comment"># book_obj.authors.add(3,4)</span></span><br><span class="line">   <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   add给第三张表添加数据 括号内既可以传数字也可以传对象</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 删 remove</span></span><br><span class="line">   <span class="comment"># book_obj.authors.remove(2)</span></span><br><span class="line">   <span class="comment"># book_obj.authors.remove(1,3)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 修改 set 这里需要注意的是set里面必须得放一个可迭代对象,所以可以放列表或者元组</span></span><br><span class="line">   <span class="comment"># book_obj.authors.set([1,2])</span></span><br><span class="line">   <span class="comment"># book_obj.authors.set([1])</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 清空 clear 括号内不携带任何参数</span></span><br><span class="line">   <span class="comment"># 清空第三张关系表某个书籍与坐着的绑定关系</span></span><br><span class="line">   <span class="comment"># book_obj.authors.clear()</span></span><br></pre></td></tr></table></figure>

<h2 id="正反向概念"><a href="#正反向概念" class="headerlink" title="正反向概念"></a>正反向概念</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向</span></span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">外键字段在我手上,我查你就是正向</span><br><span class="line">外键字段不在我手上,我查你就是反向</span><br><span class="line"></span><br><span class="line">book &gt;&gt; 外键字段在书上(正向) &gt;&gt; publish</span><br><span class="line">publish &gt;&gt; 外键字段不在publish上 &gt;&gt; book</span><br><span class="line"></span><br><span class="line">一对一和多对多正反向判断也是如此</span><br><span class="line">正向查询按字段,反向查询按表名小写加_<span class="built_in">set</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><h2 id="子查询-基于对象的跨表查询"><a href="#子查询-基于对象的跨表查询" class="headerlink" title="子查询(基于对象的跨表查询)"></a>子查询(基于对象的跨表查询)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 基于对象的跨表查询</span></span><br><span class="line"><span class="comment"># 1. 查询书籍主键为1的出版社</span></span><br><span class="line">book = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">publish = book.publish</span><br><span class="line"><span class="built_in">print</span>(publish)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查询书籍主键为1的作者</span></span><br><span class="line">book = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line"><span class="comment"># authors = book.authors</span></span><br><span class="line"><span class="comment"># print(authors) # app01.Author.None</span></span><br><span class="line"><span class="comment"># print(authors) # 返回一个queryset对象</span></span><br><span class="line">authors = book.authors.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> authors:</span><br><span class="line">    <span class="built_in">print</span>(i.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 查询作者Jason的电话号码</span></span><br><span class="line">author = models.Author.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;jason&#x27;</span>).first()</span><br><span class="line">phone = author.author_detail.phone</span><br><span class="line"><span class="built_in">print</span>(phone)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">正向查询什么时候需要添加 .all()</span></span><br><span class="line"><span class="string">    当你的结果可能有多个的时候需要加 .all()</span></span><br><span class="line"><span class="string">    如果是查询结果只有一个,那么直接拿到数据对象</span></span><br><span class="line"><span class="string">    book.publish</span></span><br><span class="line"><span class="string">    book.authors.all()</span></span><br><span class="line"><span class="string">    author.author_detail.phone</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 4. 查询出版社是东方出版社的书</span></span><br><span class="line">publish = models.Publish.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;东方出版社&#x27;</span>).first()</span><br><span class="line">books = publish.book_set.<span class="built_in">all</span>()</span><br><span class="line"><span class="built_in">print</span>(books)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(i.title)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 查询作者是Jason的书</span></span><br><span class="line">author = models.Author.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;jason&#x27;</span>).first()</span><br><span class="line">books = author.book_set.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> books:</span><br><span class="line">    <span class="built_in">print</span>(i.title)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 查询手机号是120的作者姓名</span></span><br><span class="line">author_detail = models.AuthorDetail.objects.<span class="built_in">filter</span>(phone=<span class="number">120</span>).first()</span><br><span class="line">name = author_detail.author.name</span><br><span class="line"><span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">什么时候需要使用_set?</span></span><br><span class="line"><span class="string">    当结果只有一个的时候不需要,结果多个的时候需要加_set</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="连表查询-基于双下划线的跨表查询"><a href="#连表查询-基于双下划线的跨表查询" class="headerlink" title="连表查询(基于双下划线的跨表查询)"></a>连表查询(基于双下划线的跨表查询)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于双下划线的跨表查询</span></span><br><span class="line"><span class="comment"># 1. 查询Jason的手机号</span></span><br><span class="line">phone = models.Author.objects.<span class="built_in">filter</span>(name=<span class="string">&#x27;jason&#x27;</span>).values(<span class="string">&#x27;author_detail__phone&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(phone)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查询书籍主键为1的出版社名称和书名还有作者姓名</span></span><br><span class="line">res = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;authors__name&#x27;</span>,<span class="string">&#x27;publish__name&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 查询Jason的手机号和作者姓名</span></span><br><span class="line">res = models.AuthorDetail.objects.<span class="built_in">filter</span>(author__name=<span class="string">&#x27;jason&#x27;</span>).values(<span class="string">&#x27;phone&#x27;</span>,<span class="string">&#x27;author__name&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.查询书籍主键是1的作者的手机号</span></span><br><span class="line"><span class="comment"># book author authordetail</span></span><br><span class="line">res = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).values(<span class="string">&#x27;authors__author_detail__phone&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">只要掌握了正反向</span></span><br><span class="line"><span class="string">以及双下划线</span></span><br><span class="line"><span class="string">那么你可以无限制的跨表</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="聚合查询-amp-分组查询"><a href="#聚合查询-amp-分组查询" class="headerlink" title="聚合查询&amp;分组查询"></a>聚合查询&amp;分组查询</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询  aggregate</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">只要是跟数据库相关的模块</span></span><br><span class="line"><span class="string">    基本都在django.db.models里面</span></span><br><span class="line"><span class="string">    如果上面没有那么应该在django.db里面</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 需要先导入</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max, Min, Count, Avg, Sum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 计算所有书的凭据价格</span></span><br><span class="line">res = models.Book.objects.aggregate(Avg(<span class="string">&#x27;price&#x27;</span>),Max(<span class="string">&#x27;price&#x27;</span>),Min(<span class="string">&#x27;price&#x27;</span>),Count(<span class="string">&#x27;title&#x27;</span>),Sum(<span class="string">&#x27;price&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组查询 annotate</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">MySQL分组查询特点:</span></span><br><span class="line"><span class="string">    分组之后默认只能获取到分组的依据 组内的其他字段都无法获取</span></span><br><span class="line"><span class="string">        严格模式    only_full_group_by</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 1. 统计每一个本书的作者个数</span></span><br><span class="line">res = models.Book.objects.annotate(author_num=Count(<span class="string">&#x27;authors__pk&#x27;</span>)).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;author_num&#x27;</span>) <span class="comment"># models后面点什么就是根据什么分组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 统计每一个出版社卖的最便宜的价格</span></span><br><span class="line">res = models.Publish.objects.annotate(min_price=Min(<span class="string">&#x27;book__price&#x27;</span>)).values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;min_price&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 统计不止一个作者的书</span></span><br><span class="line"><span class="comment"># 先按照图书分组</span></span><br><span class="line"><span class="comment"># 然后过滤出不止一个作者的图书</span></span><br><span class="line">res = models.Book.objects.annotate(author_num=Count(<span class="string">&#x27;authors&#x27;</span>)).<span class="built_in">filter</span>(author_num__gt=<span class="number">1</span>).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;author_num&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">只要你的orm语句执行的结果还是一个queryset对象,你就可以无限制的使用queryset对象方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 4. 查询每个作者出的书的总价格</span></span><br><span class="line">res1 = models.Author.objects.annotate(sum_price=Sum(<span class="string">&#x27;book__price&#x27;</span>)).values(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;sum_price&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h1 id="F与Q查询"><a href="#F与Q查询" class="headerlink" title="F与Q查询"></a>F与Q查询</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F与Q查询</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F, Q</span><br><span class="line"><span class="comment"># F查询</span></span><br><span class="line"><span class="comment"># 1. 查询卖出数大于库存的书籍</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(sell__gt=F(&#x27;stock&#x27;))</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将所有书籍的价格都提升50块</span></span><br><span class="line">models.Book.objects.update(price=F(<span class="string">&#x27;price&#x27;</span>)+<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 将所有书的名字后面添加上 &quot;爆款&quot; 两个字</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;在操作字符类型的数据的时候 F不能够直接做到字符串的拼接&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># from django.db.models.functions import Concat</span></span><br><span class="line"><span class="comment"># from django.db.models import Value</span></span><br><span class="line"><span class="comment"># models.Book.objects.update(title=Concat(F(&#x27;title&#x27;),Value(&#x27; 爆款&#x27;)))</span></span><br><span class="line"><span class="comment"># models.Book.objects.update(title=F(&#x27;title&#x27;)+&#x27;爆款&#x27;) # 所有的名称会直接变成空白</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Q查询</span></span><br><span class="line"><span class="comment"># 1. 查询卖出数大于100或者价格小于600的书</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(stock__gt=100,price__lt=600)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;filter括号内的多个参数是and关系&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># print(res)  # &lt;QuerySet []&gt;</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.filter(Q(stock__gt=100)|Q(price__lt=600))</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Q的高阶用法 能够将查询条件的左边也变成字符串的形式</span></span><br><span class="line">q = Q()</span><br><span class="line">q.connector = <span class="string">&#x27;or&#x27;</span></span><br><span class="line">q.children.append((<span class="string">&#x27;sell__gt&#x27;</span>,<span class="number">100</span>))</span><br><span class="line">q.children.append((<span class="string">&#x27;stock__lt&#x27;</span>,<span class="number">600</span>))</span><br><span class="line">res = models.Book.objects.<span class="built_in">filter</span>(q) <span class="comment"># filter内也支持直接放q对象,默认还是and关系</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<h1 id="Django如何开启事务"><a href="#Django如何开启事务" class="headerlink" title="Django如何开启事务"></a>Django如何开启事务</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">原子性</span></span><br><span class="line"><span class="string">	不可分割的最下单位</span></span><br><span class="line"><span class="string">一致性</span></span><br><span class="line"><span class="string">	与原子性相辅相成</span></span><br><span class="line"><span class="string">隔离性</span></span><br><span class="line"><span class="string">	事务之间相互隔离</span></span><br><span class="line"><span class="string">持久性</span></span><br><span class="line"><span class="string">	事务一旦确认永久生效</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">事务的回滚 rollback</span></span><br><span class="line"><span class="string">事务的确认 commit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># django中开启事务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">        <span class="comment"># sql1</span></span><br><span class="line">        <span class="comment"># sql2</span></span><br><span class="line">        <span class="comment"># 在with代码块内书写的所有orm操作都是属于同一个事务</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;执行其他操作&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="orm常用字段和参数"><a href="#orm常用字段和参数" class="headerlink" title="orm常用字段和参数"></a>orm常用字段和参数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> AutoField</span><br><span class="line">	主键字段 primary_key=<span class="literal">True</span></span><br><span class="line"><span class="number">2.</span> CharField</span><br><span class="line">	max_length</span><br><span class="line">    verbose_name</span><br><span class="line"><span class="number">3.</span> IntegerField</span><br><span class="line"><span class="number">4.</span> BigIntegerField</span><br><span class="line"><span class="number">5.</span> DecimalField</span><br><span class="line">	max_digits</span><br><span class="line">    decimal_places</span><br><span class="line"><span class="number">6.</span> EmailField</span><br><span class="line"><span class="number">7.</span> DateTimeField</span><br><span class="line"><span class="number">8.</span> DateField</span><br><span class="line">	auto_now</span><br><span class="line">    auto_now_add</span><br><span class="line"><span class="number">9.</span> BooleanField(Field)  布尔值类型</span><br><span class="line">	该字段传布尔值(<span class="literal">False</span>/<span class="literal">True</span>) 数据库里对应<span class="number">0</span>/<span class="number">1</span></span><br><span class="line"><span class="number">10.</span> TextField(Field)  文本类型 </span><br><span class="line">	该字段可以用来存放大段内容(文章,博客...) 没有字数限制</span><br><span class="line"><span class="number">11.</span> FileField(Field)	文件字段</span><br><span class="line">	upload_to = <span class="string">&quot;/data&quot;</span>	给该字段传一个文件对象,会自动保存到/date目录下,然后将文件路径存储到数据库</span><br><span class="line"></span><br><span class="line"><span class="comment"># django除了给你提供了很多的字段类型之外 还支持自定义类型字段</span></span><br></pre></td></tr></table></figure>

<h1 id="数据库查询优化"><a href="#数据库查询优化" class="headerlink" title="数据库查询优化"></a>数据库查询优化</h1><ul>
<li><h2 id="only与defer"><a href="#only与defer" class="headerlink" title="only与defer"></a>only与defer</h2></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># orm语句的特点</span></span><br><span class="line">惰性查询</span><br><span class="line">如果仅仅只是书写了orm语句,但是在后面并没有用到该语句查询出来的参数,那么不会进行数据库查询</span><br><span class="line"></span><br><span class="line"><span class="comment"># 想要获取书籍表中的所有书籍的名字</span></span><br><span class="line">res = models.Books.objects.values(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(title.get(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"></span><br><span class="line">res = models.Book.objects.only(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(i.title) <span class="comment"># 点击only括号中的字段 不会走数据库</span></span><br><span class="line">    <span class="built_in">print</span>(i.price) <span class="comment"># 点击only括号内的没有的字段 会重新走数据库查询 而all不需要走了</span></span><br><span class="line"></span><br><span class="line">res = models.Book.objects.defer(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(i.price)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">defer与only刚好相反</span></span><br><span class="line"><span class="string">defer括号内的字段不在查询出来的对象里面 查询该字段重新走数据库</span></span><br><span class="line"><span class="string">而如果查询的是非括号内的字段 则不需要走数据库了</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="select-related-与-prefetch-related"><a href="#select-related-与-prefetch-related" class="headerlink" title="select_related 与 prefetch_related"></a>select_related 与 prefetch_related</h2></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># select_related与prefetch_related  跟跨表操作有关</span></span><br><span class="line"><span class="comment"># res = models.Book.objects.all()</span></span><br><span class="line"><span class="comment"># for i in res:</span></span><br><span class="line"><span class="comment">#     print(i.publish.name)  # 每循环一次就要走一次数据库查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># res = models.Book.objects.select_related(&#x27;authors&#x27;)  # INNER JOIN</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">select_related内部直接先将book与publish连起来 然后一次性将大表里面的所有数据</span></span><br><span class="line"><span class="string">全部封装给查询出来的对象</span></span><br><span class="line"><span class="string">    这个时候对象无论是点击book表的数据还是publish的数据都无需再走数据库查询了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">select_related括号内只能放外键字段    一对多 一对一</span></span><br><span class="line"><span class="string">    多对多也不行</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in res:</span></span><br><span class="line"><span class="comment">#     print(i.publish.name)  # 每循环一次就要走一次数据库查询</span></span><br><span class="line"></span><br><span class="line">res = models.Book.objects.prefetch_related(<span class="string">&#x27;publish&#x27;</span>)  <span class="comment"># 子查询</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">prefetch_related该方法内部其实就是子查询</span></span><br><span class="line"><span class="string">    将子查询查询出来的所有结果也给你封装到对象中</span></span><br><span class="line"><span class="string">    给你的感觉好像也是一次性搞定的</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(i.publish.name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
  </article>
  <footer class="f-cf">
    
      <a href="/2021/03/10/03%20Django%E9%AB%98%E7%BA%A7-03django%E9%AB%98%E7%BA%A7/" class="link f-fl">⟵03 Django高级</a>
    
    
      <a href="/2021/03/04/01%20%E7%AE%80%E6%98%93%E7%89%88%E6%9C%ACweb%E6%A1%86%E6%9E%B6-01%E7%AE%80%E6%98%93%E7%89%88%E6%9C%ACweb%E6%A1%86%E6%9E%B6/" class="link f-fr">01 简易版本web框架⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>